var w=(function(){var p,m,a,c,g,s=window.PackageModule,E=function(){p=$("#packages-table").DataTable({searchDelay:500,processing:!0,serverSide:!1,ajax:{url:s.routes.index,type:"GET"},columns:[{data:"title"},{data:"price"},{data:"period_days"},{data:"top_days"},{data:"is_free"},{data:"status"},{data:null}],columnDefs:[{targets:0,render:function(t,r,e){var n=e.title_translations&&(e.title_translations[s.locale]||e.title_translations.en)||e.title,i="";return e.is_free&&(i='<span class="badge badge-light-success ms-2">'+s.labels.free+"</span>"),`<div class="d-flex align-items-center">
                            <div class="me-3" style="width: 8px; height: 40px; background: ${e.label_color||"#3b82f6"}; border-radius: 4px;"></div>
                            <div>
                                <span class="fw-bold">${n}</span>${i}
                                ${e.is_featured?'<i class="ki-duotone ki-star fs-6 text-warning ms-1"><span class="path1"></span><span class="path2"></span></i>':""}
                            </div>
                        </div>`}},{targets:1,render:function(t,r,e){return e.is_free?'<span class="badge badge-light-success">'+s.labels.free+"</span>":e.price+" KWD"}},{targets:2,render:function(t,r,e){return e.period_days+" "+s.labels.days}},{targets:3,render:function(t,r,e){return e.top_days>0?`<span class="badge badge-light-primary">${e.top_days} ${s.labels.days_top}</span>`:"-"}},{targets:4,render:function(t,r,e){return e.is_free?`<span class="badge badge-light-success">${e.free_credits_per_user||0} ${s.labels.credits}</span>`:'<span class="badge badge-light-info">'+s.labels.paid+"</span>"}},{targets:5,render:function(t,r,e){var n=e.status?"badge-light-success":"badge-light-danger",i=e.status_label||(e.status?"Active":"Inactive");return`<span class="badge ${n}">${i}</span>`}},{targets:-1,data:null,orderable:!1,className:"text-end",render:function(t,r,e){return`
                            <button class="btn btn-icon btn-active-light-primary w-30px h-30px me-3" data-package-action="edit" data-id="${e.id}">
                                <i class="ki-duotone ki-pencil fs-3"><span class="path1"></span><span class="path2"></span></i>
                            </button>
                            <button class="btn btn-icon btn-active-light-danger w-30px h-30px" data-package-action="delete" data-id="${e.id}">
                                <i class="ki-duotone ki-trash fs-3"><span class="path1"></span><span class="path2"></span><span class="path3"></span><span class="path4"></span><span class="path5"></span></i>
                            </button>
                        `}}]}),p.$,$("#package-search").on("keyup",function(){p.search(this.value).draw()})},B=function(){var t=document.getElementById("isFreePackage"),r=document.getElementById("freeCreditsSection"),e=document.getElementById("priceSection");function n(){var u=t.checked;r&&(r.style.display=u?"block":"none"),e&&(e.style.display=u?"none":"block"),u&&(a.querySelector('[name="price"]').value=0)}t&&(t.addEventListener("change",n),n());var i=document.getElementById("periodDays"),o=document.getElementById("topDays"),l=document.getElementById("freeDays");function d(){var u=parseInt(i.value)||0,b=parseInt(o.value)||0;l.value=Math.max(0,u-b)}i.addEventListener("input",d),o.addEventListener("input",function(){var u=parseInt(i.value)||0,b=parseInt(o.value)||0;b>u&&(o.value=u),d()});var f=a.querySelector('[name="label_color"]'),_=document.getElementById("labelColorText"),y=a.querySelector('[name="card_color"]'),k=document.getElementById("cardColorText"),S=document.getElementById("packagePreview"),I=document.getElementById("previewLabel");function v(){S.style.backgroundColor=y.value,S.style.borderColor=f.value,I.style.backgroundColor=f.value}f.addEventListener("input",function(){_.value=this.value,v()}),_.addEventListener("input",function(){/^#[0-9A-Fa-f]{6}$/.test(this.value)&&(f.value=this.value,v())}),y.addEventListener("input",function(){k.value=this.value,v()}),k.addEventListener("input",function(){/^#[0-9A-Fa-f]{6}$/.test(this.value)&&(y.value=this.value,v())})},C=function(){g=FormValidation.formValidation(a,{fields:{"title[en]":{validators:{notEmpty:{message:"English title is required"}}},"title[ar]":{validators:{notEmpty:{message:"Arabic title is required"}}},price:{validators:{notEmpty:{message:"Price is required"},numeric:{message:"Price must be a number"}}},period_days:{validators:{notEmpty:{message:"Period is required"},integer:{message:"Period must be an integer"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}}),c.addEventListener("click",function(t){t.preventDefault(),g&&g.validate().then(function(r){if(r=="Valid"){c.setAttribute("data-kt-indicator","on"),c.disabled=!0;var e=new FormData(a),n=e.get("id"),i=n?s.routes.update.replace("__ID__",n):s.routes.store,o=n?"PUT":"POST";n&&(e.append("_method","PUT"),o="POST"),e.has("status")||e.append("status",0),e.has("is_featured")||e.append("is_featured",0),e.has("is_free")||e.append("is_free",0),axios({method:o,url:i,data:e,headers:{"Content-Type":"multipart/form-data"}}).then(function(l){c.removeAttribute("data-kt-indicator"),c.disabled=!1,Swal.fire({text:l.data.message,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok!",customClass:{confirmButton:"btn btn-primary"}}).then(function(d){d.isConfirmed&&(m.hide(),p.ajax.reload())})}).catch(function(l){c.removeAttribute("data-kt-indicator"),c.disabled=!1;var d=l.response?.data?.message||"Sorry, looks like there are some errors detected, please try again.";if(l.response?.data?.errors){var f=l.response.data.errors;d=Object.values(f).flat().join("<br>")}Swal.fire({html:d,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok!",customClass:{confirmButton:"btn btn-primary"}})})}})})},h=function(){a.reset(),a.querySelector('[name="id"]').value="",a.querySelector('[name="label_color"]').value="#3b82f6",a.querySelector('[name="card_color"]').value="#eff6ff",document.getElementById("labelColorText").value="#3b82f6",document.getElementById("cardColorText").value="#eff6ff",document.getElementById("freeDays").value="";var t=document.getElementById("isFreePackage");t&&(t.checked=!1);var r=document.getElementById("freeCreditsSection");r&&(r.style.display="none");var e=document.getElementById("priceSection");e&&(e.style.display="block");var n=document.getElementById("packagePreview"),i=document.getElementById("previewLabel");n&&i&&(n.style.backgroundColor="#eff6ff",n.style.borderColor="#3b82f6",i.style.backgroundColor="#3b82f6")},x=function(){$(document).on("click",'[data-package-action="open-form"]',function(){h(),document.getElementById("packageFormModalTitle").innerText=s.messages.create_title||"Add Package",m.show()}),$(document).on("click",'[data-package-action="edit"]',function(){$(this).data("id");var t=p.row($(this).closest("tr")).data();h(),a.querySelector('[name="id"]').value=t.id,a.querySelector('[name="title[en]"]').value=t.title_translations?.en||"",a.querySelector('[name="title[ar]"]').value=t.title_translations?.ar||"",a.querySelector('[name="description[en]"]').value=t.description_translations?.en||"",a.querySelector('[name="description[ar]"]').value=t.description_translations?.ar||"",a.querySelector('[name="price"]').value=t.price,a.querySelector('[name="period_days"]').value=t.period_days,a.querySelector('[name="top_days"]').value=t.top_days||0,document.getElementById("freeDays").value=t.free_days||0;var r=t.label_color||"#3b82f6",e=t.card_color||"#eff6ff";a.querySelector('[name="label_color"]').value=r,a.querySelector('[name="card_color"]').value=e,document.getElementById("labelColorText").value=r,document.getElementById("cardColorText").value=e;var n=document.getElementById("packagePreview"),i=document.getElementById("previewLabel");n.style.backgroundColor=e,n.style.borderColor=r,i.style.backgroundColor=r,a.querySelector('[name="status"]').checked=t.status,a.querySelector('[name="is_featured"]').checked=t.is_featured;var o=document.getElementById("isFreePackage");o&&(o.checked=t.is_free);var l=document.getElementById("freeCreditsSection");l&&(l.style.display=t.is_free?"block":"none");var d=document.getElementById("priceSection");d&&(d.style.display=t.is_free?"none":"block"),t.free_credits_per_user&&(a.querySelector('[name="free_credits_per_user"]').value=t.free_credits_per_user),document.getElementById("packageFormModalTitle").innerText=s.messages.edit_title||"Edit Package",m.show()}),$(document).on("click",'[data-package-action="delete"]',function(){var t=$(this).data("id");Swal.fire({text:s.confirm.deleteMessage,icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:s.confirm.confirm,cancelButtonText:s.confirm.cancel,customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(r){r.value&&axios.delete(s.routes.destroy.replace("__ID__",t)).then(function(e){Swal.fire({text:e.data.message,icon:"success",buttonsStyling:!1,confirmButtonText:"Ok!",customClass:{confirmButton:"btn fw-bold btn-primary"}}).then(function(){p.ajax.reload()})}).catch(function(e){Swal.fire({text:e.response?.data?.message||"Error deleting package.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})};return{init:function(){m=new bootstrap.Modal(document.querySelector("#packageFormModal")),a=document.querySelector("#packageForm"),c=document.querySelector("#packageFormSubmit"),E(),B(),C(),x()}}})();KTUtil.onDOMContentLoaded(function(){w.init()});
