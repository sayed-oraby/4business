import{a as w}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const r=window.BlogModule||{},u=$("#blogs-table");if(!u.length)return;const H=r.locale||document.documentElement.lang||"en",o=document.getElementById("blogForm"),P=document.getElementById("blogFormModal"),z=P?new bootstrap.Modal(P):null,y=document.getElementById("blogViewModal"),ae=y?new bootstrap.Modal(y):null,K=document.getElementById("blogTagModal"),B=K?new bootstrap.Modal(K):null,N=document.querySelector('[data-blog-action="bulk-delete"]'),T=document.getElementById("select-all-blogs"),v=$("[data-blog-tags]"),L=document.querySelector("[data-blog-dropzone]"),q=L?.querySelector("[data-blog-dropzone-previews]"),U=L?.querySelector("[data-blog-dropzone-message]"),re=document.getElementById("blogDropzonePreviewTemplate")?.innerHTML,g=$("[data-blog-author]"),E=o?.querySelector("[data-blog-errors]"),X=document.querySelectorAll("[data-blog-locale-tab]"),x=document.head.querySelector('meta[name="csrf-token"]')?.content;let C=null,F=null,m=null,j=Array.isArray(r.tags)?r.tags:[],V=0;const d=new Set;le(),oe(),se();const k={status:"",state:"active"},b=u.DataTable({processing:!0,serverSide:!0,order:[],ajax:(e,t)=>{const n={draw:e.draw,start:e.start,length:e.length,"search[value]":e.search?.value,"order[0][column]":e.order?.[0]?.column,"order[0][dir]":e.order?.[0]?.dir,status:k.status,state:k.state};k.state==="archived"?n.trashed="only":k.state==="all"&&(n.trashed="with"),w.get(r.routes.data,{params:n}).then(a=>t(a.data)).catch(()=>t({data:[],recordsTotal:0,recordsFiltered:0,draw:e.draw}))},columnDefs:[{targets:0,orderable:!1,className:"text-center align-middle"},{targets:-1,orderable:!1,className:"text-end"}],columns:[{data:"id",render:e=>`
                    <div class="form-check form-check-sm form-check-custom">
                        <input class="form-check-input blog-select" type="checkbox" value="${e}">
                    </div>
                `},{data:null,render:(e,t,n)=>{const a=p(n.title_translations,n.title),l=p(n.short_description_translations,n.short_description);return`
                        <div class="d-flex align-items-center">
                            <img src="${n.image_url||""}" class="blog-thumb me-4" alt="${a??""}">
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-gray-900">${a??"—"}</span>
                                <span class="text-muted fs-7">${l??"—"}</span>
                            </div>
                        </div>
                    `}},{data:null,render:(e,t,n)=>{if(n.is_deleted)return`<span class="badge badge-light-danger">${r.states?.archived??n.state_label}</span>`;const a=r.statusLabels?.[n.status]??n.status_label??n.status;return`<span class="badge ${n.status==="published"?"badge-light-success":n.status==="draft"?"badge-light-warning":"badge-light-secondary"}">${a}</span>`}},{data:"tags",render:(e=[])=>e.length?e.map(t=>`<span class="badge badge-light fw-semibold me-1 mb-1">${p(t.title_translations,t.title)}</span>`).join(""):'<span class="text-muted">—</span>'},{data:"author",render:e=>e?`
                        <div class="d-flex flex-column">
                            <span class="fw-semibold text-gray-900">${e.name??"—"}</span>
                            <span class="text-muted fs-7">${e.email??""}</span>
                        </div>
                    `:'<span class="text-muted">—</span>'},{data:"updated_at",render:e=>`<span class="text-muted fw-semibold">${O(e)}</span>`},{data:null,render:e=>{const t=[];return t.push(`
                        <button class="btn btn-sm btn-icon btn-light-info" data-blog-action="view" title="${r.i18n.view}" data-id="${e.id}">
                            ${R("ki-eye")}
                        </button>
                    `),r.can?.update&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-primary" data-blog-action="edit" title="${r.i18n.edit}" data-id="${e.id}">
                                ${R("ki-pencil")}
                            </button>
                        `),r.can?.delete&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-danger" data-blog-action="delete" title="${r.i18n.delete}" data-id="${e.id}">
                                ${R("ki-trash")}
                            </button>
                        `),`<div class="d-flex justify-content-end gap-2">${t.join("")}</div>`}}],drawCallback:()=>{u.find(".blog-select").each(function(){this.checked=d.has(this.value)}),M()}});document.getElementById("blog-search")?.addEventListener("keyup",e=>{b.search(e.target.value).draw()}),document.querySelectorAll('[data-blog-filter="status"]').forEach(e=>{e.addEventListener("change",t=>{k.status=t.target.value,b.ajax.reload()})}),document.querySelectorAll('[data-blog-filter="state"]').forEach(e=>{e.addEventListener("change",t=>{k.state=t.target.value||"active",b.ajax.reload()})}),document.querySelectorAll('[data-blog-action="open-form"]').forEach(e=>{e.addEventListener("click",()=>{Q(),z?.show()})}),document.querySelector('[data-blog-action="open-tag-modal"]')?.addEventListener("click",()=>{if(!B)return;const e=document.getElementById("blogTagForm");e?.reset(),A(e),B.show()}),document.getElementById("blogTagForm")?.addEventListener("submit",e=>{e.preventDefault(),ue()}),u.on("click",'[data-blog-action="view"]',function(){const e=b.row($(this).closest("tr")).data();e&&(fe(e),ae?.show())}),u.on("click",'[data-blog-action="edit"]',function(){const e=b.row($(this).closest("tr")).data();e&&(ie(e),z?.show())}),u.on("click",'[data-blog-action="delete"]',function(){const e=this.getAttribute("data-id");e&&Z("single").then(t=>{t&&w.post(r.routes.destroy.replace("__ID__",e),{_method:"DELETE"},{headers:{"X-CSRF-TOKEN":x}}).then(()=>{f(r.messages.deleted),d.delete(e),b.ajax.reload(null,!1),M()}).catch(()=>f("Error",!0))})}),u.on("change",".blog-select",function(){const e=String(this.value);e&&(this.checked?d.add(e):d.delete(e),M())}),T?.addEventListener("change",()=>{const e=T.checked;u.find(".blog-select").each(function(){this.checked=e;const t=String(this.value);t&&(e?d.add(t):d.delete(t))}),M()}),N?.addEventListener("click",()=>{d.size!==0&&Z("bulk",d.size).then(e=>{e&&w.post(r.routes.bulkDestroy,{ids:Array.from(d),_method:"DELETE"},{headers:{"X-CSRF-TOKEN":x}}).then(()=>{f(r.messages.bulkDeleted),d.clear(),b.ajax.reload(),M()}).catch(()=>f("Error",!0))})}),o?.addEventListener("submit",e=>{e.preventDefault(),de()}),document.querySelector('[data-blog-action="submit-form"]')?.addEventListener("click",()=>{o?.requestSubmit()});function le(){v.select2({dropdownParent:$("#blogFormModal"),placeholder:v.data("placeholder")||"",data:G(j),ajax:{url:r.routes.tagsIndex,dataType:"json",delay:200,data:e=>({search:e.term}),processResults:e=>({results:G(e.tags??[])})}})}function G(e){return e.map(t=>({id:t.id,text:p(t.title_translations,t.title)}))}function oe(){g.length&&g.select2({dropdownParent:$("#blogFormModal"),placeholder:g.data("placeholder")||"",allowClear:!0,ajax:{url:r.routes.authors,dataType:"json",delay:250,data:e=>({search:e.term,page:e.page||1}),processResults:(e,t)=>(t.page=t.page||1,{results:(e.results||[]).map(a=>({id:a.id,text:a.text||`${a.name??""} — ${a.email??""}`,name:a.name,email:a.email})),pagination:{more:e.pagination?.more??!1}})},templateResult:ve,templateSelection:Ee})}function se(){const e=window.Dropzone;!e||!L||(e.autoDiscover=!1,m=new e(L,{url:r.routes.galleryUpload,paramName:"file",headers:{"X-CSRF-TOKEN":x},maxFilesize:5,acceptedFiles:"image/*",addRemoveLinks:!0,dictRemoveFile:"Remove",previewsContainer:q||L,previewTemplate:re||void 0,init(){this.on("addedfile",()=>_()),this.on("sending",(t,n,a)=>{a.append("upload_token",C),F&&a.append("blog_id",F)}),this.on("success",(t,n)=>{t._galleryId=n.gallery?.id,_()}),this.on("error",()=>{f("Upload failed",!0)}),this.on("removedfile",t=>{if(!t._galleryId){_();return}w.delete(r.routes.galleryDestroy.replace("__ID__",t._galleryId),{headers:{"X-CSRF-TOKEN":x}}).then(()=>{f(r.messages.galleryDeleted),_()}).catch(()=>f("Error",!0))})}}))}function Q(){o&&(o.reset(),A(o),C=ee(),F=null,o.querySelector('input[name="blog_id"]').value="",o.querySelector('input[name="_method"]').value="POST",o.querySelector('input[name="gallery_token"]').value=C,v.val(null).trigger("change"),g.val(null).trigger("change"),m?.removeAllFiles(!0),q&&(q.innerHTML=""),_())}function ie(e){if(!o)return;Q(),F=e.id;const t=o.querySelector('input[name="blog_id"]'),n=o.querySelector('input[name="_method"]');t&&(t.value=e.id),n&&(n.value="PUT"),C=ee(),o.querySelector('input[name="gallery_token"]').value=C,J('select[name="status"]',e.status??"draft"),Object.entries(e.title_translations??{}).forEach(([l,s])=>{J(`input[name="title[${l}]"]`,s)}),Object.entries(e.short_description_translations??{}).forEach(([l,s])=>{const i=o.querySelector(`textarea[name="short_description[${l}]"]`);i&&(i.value=s??"")}),Object.entries(e.description_translations??{}).forEach(([l,s])=>{const i=o.querySelector(`textarea[name="description[${l}]"]`);i&&(i.value=s??"")});const a=(e.tags||[]).map(l=>l.id);W(e.tags||[]),v.val(a).trigger("change"),e.author?(me(e.author),g.val(e.author.id).trigger("change")):g.val(null).trigger("change"),ce(e.id)}function J(e,t){if(!o)return;const n=o.querySelector(e);n&&(n.value=t??"")}function ce(e){if(!m)return;const t=++V;m.removeAllFiles(!0),q&&(q.innerHTML=""),_(),w.get(r.routes.gallery.replace("__ID__",e)).then(({data:n})=>{if(t!==V||F!==e)return;(n.gallery??[]).forEach(l=>{const s={name:`gallery-${l.id}`,size:1,accepted:!0,_galleryId:l.id};m.emit("addedfile",s),m.emit("thumbnail",s,l.image_url),m.emit("complete",s)}),_()})}function de(){if(!o)return;const e=o.querySelector('input[name="blog_id"]')?.value,t=!!e,n=new FormData(o),a=t?r.routes.update.replace("__ID__",e):r.routes.store;t||n.set("_method","POST"),A(o),w.post(a,n,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":x}}).then(()=>{z?.hide(),b.ajax.reload(null,!1),f(t?r.messages.updated:r.messages.created)}).catch(l=>Y(l,o))}function ue(){const e=document.getElementById("blogTagForm");if(!e)return;const t=new FormData(e);A(e),w.post(r.routes.tagsStore,t,{headers:{"X-CSRF-TOKEN":x}}).then(({data:n})=>{B?.hide(),f(r.messages.tagCreated);const a=n?.data?.tag;a&&(W([a]),v.val([...v.val()||[],String(a.id)]).trigger("change"))}).catch(n=>Y(n,e))}function W(e){(Array.isArray(e)?e:[]).forEach(n=>{if(n&&!j.find(a=>a.id===n.id)){j.push(n);const a=new Option(p(n.title_translations,n.title),n.id,!1,!1);v.append(a)}})}function me(e){if(!e||!g.length)return;if(!Array.from(g[0].options).some(n=>Number(n.value)===Number(e.id))){const n=new Option(e.name??e.text??"-",e.id,!1,!1);g.append(n)}}function A(e){const t=e??o;t&&(t.querySelectorAll(".is-invalid").forEach(n=>n.classList.remove("is-invalid")),t.querySelectorAll(".invalid-feedback").forEach(n=>n.remove()),t.querySelectorAll("[data-error-for]").forEach(n=>{n.textContent="",n.style.display="none"}),(!e||t===o)&&(te(),ye()))}function Y(e,t){const n=t??o;if(!n)return;const a=new Set;e.response?.status===422&&e.response?.data?.errors?(Object.entries(e.response.data.errors).forEach(([l,s])=>{const i=Array.isArray(s)?s[0]:s;a.add(i);const S=ge(l),c=n.querySelector(`[name="${S}"]`);let D=n.querySelector(`[data-error-for="${l}"]`);if(D||(D=n.querySelector(`[data-error-for="${S}"]`)),c&&c.classList.add("is-invalid"),D)D.textContent=i,D.style.display="block";else if(c){let I=c.parentNode.querySelector(".invalid-feedback");I||(I=document.createElement("div"),I.classList.add("invalid-feedback"),c.parentNode.appendChild(I)),I.textContent=i}const ne=pe(l);ne&&be(ne)}),he(Array.from(a))):f("Error",!0)}function fe(e){if(!y)return;const t=p(e.title_translations,e.title),n=p(e.short_description_translations,e.short_description),a=p(e.description_translations,e.description);h("image",e.image_url);const l=y.querySelector('[data-blog-view="image"]');l&&(l.src=e.image_url||"",l.alt=t??""),h("title",t),h("short_description",n),h("description",a),h("status",e.status_label??e.status),h("state",e.state_label??(e.is_deleted?r.states?.archived:r.states?.active)),h("author",e.author?`${e.author.name??""} ${e.author.email?"— "+e.author.email:""}`:"—"),h("created_at",O(e.created_at)),h("updated_at",O(e.updated_at));const s=y.querySelector('[data-blog-view="tags"]');s&&(s.innerHTML="",(e.tags||[]).forEach(S=>{const c=document.createElement("span");c.className="badge badge-light fw-semibold",c.textContent=p(S.title_translations,S.title),s.appendChild(c)}),(e.tags||[]).length===0&&(s.innerHTML='<span class="text-muted">—</span>'));const i=y.querySelector('[data-blog-view="gallery"]');i&&(i.innerHTML="",(e.gallery||[]).forEach(S=>{const c=document.createElement("div");c.className="col-md-3",c.innerHTML=`<div class="border rounded p-2 bg-light"><img class="img-fluid rounded" src="${S.image_url}" alt=""></div>`,i.appendChild(c)}),(e.gallery||[]).length===0&&(i.innerHTML='<div class="text-muted">—</div>'))}function h(e,t){const n=y?.querySelector(`[data-blog-view="${e}"]`);n&&e!=="image"&&(n.textContent=t??"—")}function M(){const e=u.find(".blog-select"),t=u.find(".blog-select:checked");T&&(T.checked=t.length>0&&t.length===e.length,T.indeterminate=t.length>0&&t.length<e.length),N&&(N.disabled=d.size===0)}function Z(e,t=1){if(!window.Swal)return Promise.resolve(confirm(r.confirm?.deleteMessage??"Are you sure?"));const n=r.confirm||{},a=e==="bulk"?n.bulkTitle:n.deleteTitle;let l=e==="bulk"?n.bulkMessage:n.deleteMessage;return e==="bulk"&&(l=l?.replace(":count",t)),Swal.fire({title:a,text:l,icon:"warning",showCancelButton:!0,confirmButtonText:n.confirm||"OK",cancelButtonText:n.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(s=>s.isConfirmed)}function f(e,t=!1){window.toastr?t?toastr.error(e):toastr.success(e):alert(e)}function ee(){return window.crypto?.randomUUID?window.crypto.randomUUID():`blog-${Date.now()}-${Math.random().toString(16).slice(2)}`}function p(e={},t=null){if(e&&typeof e=="object"){if(e[H])return e[H];const n=document.documentElement.dataset.fallbackLocale||"en";if(e[n])return e[n];const a=Object.values(e).find(Boolean);if(a)return a}return t}function O(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function R(e){return`<i class="ki-outline ${e} fs-2"></i>`}function ge(e){return e.replace(/\.(\w+)/g,"[$1]")}function he(e){if(!E)return;if(!e.length){te();return}E.innerHTML="";const t=document.createElement("ul");e.forEach(n=>{const a=document.createElement("li");a.textContent=n,t.appendChild(a)}),E.appendChild(t),E.classList.remove("d-none")}function te(){E&&(E.classList.add("d-none"),E.innerHTML="")}function pe(e){const t=e.match(/\.([a-z]{2})$/i);return t?t[1]:null}function be(e){X.forEach(t=>{t.dataset.locale===e&&t.classList.add("blog-locale-invalid")})}function ye(){X.forEach(e=>e.classList.remove("blog-locale-invalid"))}function _(){if(!U)return;const e=m?m.getAcceptedFiles().length+m.getQueuedFiles().length:0;U.classList.toggle("d-none",e>0)}function ve(e){return e.id?$(`
            <div class="d-flex flex-column">
                <span class="fw-semibold">${e.name??e.text}</span>
                <span class="text-muted fs-7">${e.email??""}</span>
            </div>
        `):e.text}function Ee(e){return e.id&&e.name?`${e.name}${e.email?" — "+e.email:""}`:e.text}});
