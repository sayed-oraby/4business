import{a as L}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const o=window.OrderStatuses;if(!o)return;const y=$("#order-statuses-table"),b=document.getElementById("orderStatusModal"),v=b?new bootstrap.Modal(b):null,a=document.getElementById("orderStatusForm"),i=document.querySelector('[data-order-status-action="submit"]'),S=a?.querySelector("[data-order-status-errors]"),u=document.getElementById("order-status-search"),I=document.querySelector("[data-filter-apply]"),D=document.querySelector("[data-filter-reset]"),g=document.querySelectorAll("[data-order-status-locale-tab]"),k="order-status-locale-invalid";let p,f={search:""};B(),c(),F();function B(){p=y.DataTable({order:[],pageLength:10,columns:[{data:"code"},{data:"title"},{data:null,render:e=>{const t=[],n=o.flags||{};return e.is_default&&t.push(n.default||"Default"),e.is_final&&t.push(n.final||"Final"),e.is_cancel&&t.push(n.cancel||"Cancel"),e.is_refund&&t.push(n.refund||"Refund"),t.join(" / ")||"â€”"}},{data:"sort_order"},{data:null,orderable:!1,className:"text-center",render:e=>x(e)}]})}function F(){document.querySelector('[data-order-status-action="open-form"]')?.addEventListener("click",()=>{C(),v?.show()}),i?.addEventListener("click",e=>{e.preventDefault(),q(e)}),a?.addEventListener("submit",e=>{e.preventDefault(),q(e)}),y.on("click",'[data-action="edit"]',function(){const e=p.row($(this).closest("tr")).data();e&&(j(e),v?.show())}),y.on("click",'[data-action="delete"]',function(){const e=p.row($(this).closest("tr")).data();e&&W().then(t=>{t&&M(e.id)})}),u?.addEventListener("keyup",R(()=>{f.search=u.value,c()},300)),I?.addEventListener("click",()=>{f.search=u?.value||"",c(),bootstrap.Offcanvas.getInstance(document.getElementById("orderStatusFiltersCanvas"))?.hide()}),D?.addEventListener("click",()=>{f.search="",u&&(u.value=""),c(),bootstrap.Offcanvas.getInstance(document.getElementById("orderStatusFiltersCanvas"))?.hide()})}function c(){let e=[];L.get(o.routes.data).then(({data:t})=>{if(e=t?.data?.statuses??[],f.search){const n=f.search.toLowerCase();e=e.filter(s=>s.code?.toLowerCase().includes(n)||s.title?.toLowerCase().includes(n))}p.clear().rows.add(e).draw()})}function q(e){if(e&&e.preventDefault(),!a)return;T(S),E(!0);const t=O(),n=t.status_id,s=!!n,r=s?o.routes.update.replace("__ID__",n):o.routes.store;L({method:s?"put":"post",url:r,data:t}).then(()=>{v?.hide(),C(),c(),E(!1)}).catch(l=>{N(l,S),E(!1)})}function M(e){const t=o.routes.destroy.replace("__ID__",e);L.delete(t).then(()=>c())}function O(){const e={};return a.querySelectorAll("input, select, textarea").forEach(n=>{const s=n.name;if(s){if(n.type==="checkbox"){e[s]=n.checked;return}if(s.startsWith("title[")&&s.endsWith("]")){const r=s.match(/title\[(.+)\]/)?.[1];r&&(e.title||(e.title={}),e.title[r]=n.value||"");return}n.value!==""&&(e[s]=n.value)}}),e.title||(e.title={}),e}function C(){if(!a)return;a.reset(),a.querySelector('input[name="status_id"]').value="",a.querySelector('input[name="_method"]').value="POST";const e=b?.querySelector("[data-order-status-form-title]");e&&(e.textContent=o.labels.create),T(S)}function j(e){if(!a)return;a.code.value=e.code??"";const t=e.title_translations||{};typeof e.title=="object"&&e.title!==null?Object.keys(e.title).forEach(s=>{const r=a.querySelector(`input[name="title[${s}]"]`);r&&(r.value=e.title[s]||"")}):t&&Object.keys(t).forEach(s=>{const r=a.querySelector(`input[name="title[${s}]"]`);r&&(r.value=t[s]||"")}),a.color.value=e.color??"",a.sort_order.value=e.sort_order??0,a.is_default.checked=!!e.is_default,a.is_final.checked=!!e.is_final,a.is_cancel.checked=!!e.is_cancel,a.is_refund.checked=!!e.is_refund,a.querySelector('input[name="status_id"]').value=e.id,a.querySelector('input[name="_method"]').value="PUT";const n=b?.querySelector("[data-order-status-form-title]");n&&(n.textContent=o.labels.edit)}function w(e){return`<i class="ki-outline ${e} fs-2"></i>`}function x(e){const t=[];return o.can?.update&&t.push(`
                <button class="btn btn-sm btn-icon btn-light-primary" data-action="edit" title="${o.labels?.edit||"Edit"}" data-id="${e.id}">
                    ${w("ki-pencil")}
                </button>
            `),o.can?.delete&&t.push(`
                <button class="btn btn-sm btn-icon btn-light-danger" data-action="delete" title="${o.labels?.delete||"Delete"}" data-id="${e.id}">
                    ${w("ki-trash")}
                </button>
            `),`<div class="d-flex justify-content-center gap-2">${t.join("")}</div>`}function N(e,t){if(!a)return;const n=a,s=new Set;if(e.response?.status===422&&e.response?.data?.errors){if(Object.entries(e.response.data.errors).forEach(([r,d])=>{const l=Array.isArray(d)?d[0]:d;s.add(l);const z=r.replace(/\./g,"[").replace(/(\[en\]|\[ar\])$/,"]$1"),m=n.querySelector(`[name="${r}"]`)||n.querySelector(`[name="${z}"]`);let _=n.querySelector(`[data-error-for="${r}"]`);if(m&&m.classList.add("is-invalid"),_)_.textContent=l,_.style.display="block";else if(m){let h=m.parentNode.querySelector(".invalid-feedback");h||(h=document.createElement("div"),h.classList.add("invalid-feedback"),m.parentNode.appendChild(h)),h.textContent=l}const A=r.match(/title\.(\w+)$/)?.[1];A&&P(A)}),t&&s.size>0){t.innerHTML="";const r=document.createElement("ul");s.forEach(d=>{const l=document.createElement("li");l.textContent=d,r.appendChild(l)}),t.appendChild(r),t.classList.remove("d-none")}}else if(t){const r=e.response?.data?.message||"An error occurred";t.innerHTML=`<ul><li>${r}</li></ul>`,t.classList.remove("d-none")}}function T(e){a&&(a.querySelectorAll(".is-invalid").forEach(t=>t.classList.remove("is-invalid")),a.querySelectorAll("[data-error-for]").forEach(t=>{t.textContent="",t.style.display="none"}),e&&(e.classList.add("d-none"),e.innerHTML=""),H())}function P(e){g.forEach(t=>{t.dataset.locale===e&&t.classList.add(k)})}function H(){g.forEach(e=>e.classList.remove(k))}function E(e){i&&(e?(i.setAttribute("data-kt-indicator","on"),i.disabled=!0):(i.setAttribute("data-kt-indicator","off"),i.disabled=!1))}function R(e,t){let n;return(...s)=>{clearTimeout(n),n=setTimeout(()=>e(...s),t)}}function W(){return window.Swal?Swal.fire({text:o.labels.delete??"Delete?",icon:"warning",showCancelButton:!0,confirmButtonText:o.labels.delete??"Delete",cancelButtonText:o.labels.cancel??"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(e=>e.isConfirmed):Promise.resolve(confirm(o.labels.delete??"Delete?"))}});
