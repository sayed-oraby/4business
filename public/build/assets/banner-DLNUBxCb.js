import{a as k}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const l=window.BannerModule||{},d=$("#banner-table");if(!d.length)return;const C=l.locale||document.documentElement.lang||"en",a=document.getElementById("bannerForm"),T=document.getElementById("bannerFormModal"),q=T?new bootstrap.Modal(T):null,o=document.getElementById("bannerViewModal"),I=o?new bootstrap.Modal(o):null,x=document.querySelector('[data-banner-action="bulk-delete"]'),y=document.getElementById("select-all-banners"),L=document.head.querySelector('meta[name="csrf-token"]')?.content,b=o?{image:o.querySelector('[data-banner-view="image"]'),title:o.querySelector('[data-banner-view="title"]'),description:o.querySelector('[data-banner-view="description"]'),placement:o.querySelector('[data-banner-view="placement"]'),status:o.querySelector('[data-banner-view="status"]'),state:o.querySelector('[data-banner-view="state"]'),button_label:o.querySelector('[data-banner-view="button_label"]'),button_url:o.querySelector('[data-banner-view="button_url"]'),created_at:o.querySelector('[data-banner-view="created_at"]'),updated_at:o.querySelector('[data-banner-view="updated_at"]')}:{},h={placement:"",status:"",state:"active"},s=new Set,u=d.DataTable({processing:!0,serverSide:!0,order:[],ajax:(e,t)=>{const n={draw:e.draw,start:e.start,length:e.length,"search[value]":e.search?.value,"order[0][column]":e.order?.[0]?.column,"order[0][dir]":e.order?.[0]?.dir,placement:h.placement,status:h.status};h.state==="archived"?n.trashed="only":h.state==="all"&&(n.trashed="with"),k.get(l.routes.data,{params:n}).then(r=>t(r.data)).catch(()=>t({data:[],recordsTotal:0,recordsFiltered:0,draw:e.draw}))},columnDefs:[{targets:0,orderable:!1,className:"text-center align-middle"},{targets:-1,orderable:!1,className:"text-center align-middle"}],columns:[{data:"id",render:e=>`
                    <div class="form-check form-check-sm form-check-custom">
                        <input class="form-check-input banner-select" type="checkbox" value="${e}">
                    </div>
                `},{data:"image_url",render:(e,t,n)=>`
                    <div class="d-flex align-items-center">
                        <img src="${e||""}" class="banner-thumb me-3" alt="${n.title??""}">
                    </div>
                `},{data:"title",render:(e,t,n)=>{const r=E(n.title_translations,n.title),i=E(n.description_translations,n.description);return`
                        <div class="d-flex flex-column">
                            <span class="fw-bold text-gray-900">${r??"—"}</span>
                            <span class="text-muted fs-7">${i??"—"}</span>
                        </div>
                    `}},{data:"status_label",render:(e,t,n)=>n.is_deleted?`<span class="badge badge-light-danger">${l.states?.archived??e}</span>`:`<span class="badge ${n.status==="active"?"badge-light-success":"badge-light-secondary"}">${e}</span>`},{data:null,render:e=>`
                    <div class="d-flex justify-content-center gap-2">

                        <button class="btn btn-sm btn-icon btn-light-primary" data-banner-action="edit" title="${l.i18n.edit}" data-id="${e.id}">
                            ${M("ki-pencil")}
                        </button>
                        <button class="btn btn-sm btn-icon btn-light-danger" data-banner-action="delete" title="${l.i18n.delete}" data-id="${e.id}">
                            ${M("ki-trash")}
                        </button>
                    </div>
                `}],drawCallback:()=>{d.find(".banner-select").each(function(){this.checked=s.has(this.value)}),S()}});document.getElementById("banner-search")?.addEventListener("keyup",e=>{u.search(e.target.value).draw()}),document.querySelectorAll('[data-banner-filter="placement"]').forEach(e=>{e.addEventListener("change",t=>{h.placement=t.target.value,u.ajax.reload()})}),document.querySelectorAll('[data-banner-filter="status"]').forEach(e=>{e.addEventListener("change",t=>{h.status=t.target.value,u.ajax.reload()})}),document.querySelectorAll('[data-banner-filter="state"]').forEach(e=>{e.addEventListener("change",t=>{h.state=t.target.value||"active",u.ajax.reload()})}),document.querySelectorAll('[data-banner-action="open-form"]').forEach(e=>{e.addEventListener("click",()=>{A(),q?.show()})}),d.on("click",'[data-banner-action="view"]',function(){const e=u.row($(this).closest("tr")).data();e&&(z(e),I?.show())}),d.on("click",'[data-banner-action="edit"]',function(){const e=u.row($(this).closest("tr")).data();e&&(F(e),q?.show())}),d.on("click",'[data-banner-action="delete"]',function(){const e=this.getAttribute("data-id");e&&j("single").then(t=>{t&&k.post(l.routes.destroy.replace("__ID__",e),{_method:"DELETE"},{headers:{"X-CSRF-TOKEN":L}}).then(()=>{g(l.messages.deleted),s.delete(e),u.ajax.reload(null,!1),S()}).catch(()=>g("Error",!0))})}),d.on("change",".banner-select",function(){const e=String(this.value);e&&(this.checked?s.add(e):s.delete(e),S())}),y?.addEventListener("change",()=>{const e=y.checked;d.find(".banner-select").each(function(){this.checked=e;const t=String(this.value);t&&(e?s.add(t):s.delete(t))}),S()}),x?.addEventListener("click",()=>{s.size!==0&&j("bulk",s.size).then(e=>{e&&k.post(l.routes.bulkDestroy,{ids:Array.from(s),_method:"DELETE"},{headers:{"X-CSRF-TOKEN":L}}).then(()=>{g(l.messages.bulkDeleted),s.clear(),u.ajax.reload(),S()}).catch(()=>g("Error",!0))})}),a?.addEventListener("submit",e=>{e.preventDefault(),N()});function A(){if(!a)return;a.reset();const e=a.querySelector('input[name="banner_id"]');e&&(e.value="");const t=a.querySelector('input[name="_method"]');t&&(t.value="POST");const n=a.querySelector("#banner-image-preview-container"),r=a.querySelector("#banner-image-preview");n&&n.classList.add("d-none"),r&&(r.src=""),D()}function F(e){if(!a)return;A();const t=a.querySelector('input[name="banner_id"]'),n=a.querySelector('input[name="_method"]');t&&(t.value=e.id),n&&(n.value="PUT"),p('input[name="button_label"]',e.button?.label??""),p('input[name="button_url"]',e.button?.url??""),p('select[name="placement"]',e.placement??""),p('select[name="status"]',e.status??""),p('input[name="sort_order"]',e.sort_order??0),Object.entries(e.title_translations??{}).forEach(([c,v])=>{p(`input[name="title[${c}]"]`,v)}),Object.entries(e.description_translations??{}).forEach(([c,v])=>{const f=a.querySelector(`textarea[name="description[${c}]"]`);f&&(f.value=v??"")});const r=a.querySelector("#banner-image-preview-container"),i=a.querySelector("#banner-image-preview");r&&i&&(e.image_url?(i.src=e.image_url,r.classList.remove("d-none")):(r.classList.add("d-none"),i.src=""))}function p(e,t){if(!a)return;const n=a.querySelector(e);n&&(n.value=t??"")}function N(){const e=a.querySelector('input[name="banner_id"]').value,t=!!e,n=new FormData(a),r=t?l.routes.update.replace("__ID__",e):l.routes.store,i=a.querySelector('[data-banner-action="submit-form"]');t||n.set("_method","POST"),D(),i&&(i.setAttribute("data-kt-indicator","on"),i.disabled=!0),k.post(r,n,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":L}}).then(()=>{q?.hide(),u.ajax.reload(null,!1),g(t?l.messages.updated:l.messages.created)}).catch(c=>O(c)).finally(()=>{i&&(i.removeAttribute("data-kt-indicator"),i.disabled=!1)})}function D(){if(!a)return;a.querySelectorAll(".is-invalid").forEach(t=>t.classList.remove("is-invalid")),a.querySelectorAll(".invalid-feedback").forEach(t=>t.remove()),a.querySelectorAll("[data-error-for]").forEach(t=>{t.textContent="",t.style.display="none"});const e=a.querySelector("[data-banner-errors]");e&&e.classList.add("d-none")}function O(e){if(!a)return;const t=new Set,n=a.querySelector("[data-banner-errors]");e.response?.status===422&&e.response?.data?.errors?(Object.entries(e.response.data.errors).forEach(([r,i])=>{const c=Array.isArray(i)?i[0]:i;t.add(c);const v=P(r),f=a.querySelector(`[name="${v}"]`);let _=a.querySelector(`[data-error-for="${r}"]`);if(_||(_=a.querySelector(`[data-error-for="${v}"]`)),f&&f.classList.add("is-invalid"),_)_.textContent=c,_.style.display="block";else if(f){let w=f.parentNode.querySelector(".invalid-feedback");w||(w=document.createElement("div"),w.classList.add("invalid-feedback"),f.parentNode.appendChild(w)),w.textContent=c}}),n&&t.size>0&&(n.classList.remove("d-none"),n.innerHTML='<ul class="mb-0">'+Array.from(t).map(r=>`<li>${r}</li>`).join("")+"</ul>")):g("Error",!0)}function g(e,t=!1){window.toastr?t?toastr.error(e):toastr.success(e):alert(e)}function P(e){return e.replace(/\.(\w+)/g,"[$1]")}function z(e){o&&(b.image&&(b.image.src=e.image_url||"",b.image.alt=e.title??""),m("title",E(e.title_translations,e.title)),m("description",E(e.description_translations,e.description)),m("placement",e.placement_label??e.placement),m("status",e.status_label??e.status),m("state",e.state_label??(e.is_deleted?l.states?.archived:l.states?.active)),m("button_label",e.button?.label),b.button_url&&(b.button_url.textContent=e.button?.url??"—",b.button_url.href=e.button?.url||"#"),m("created_at",B(e.created_at)),m("updated_at",B(e.updated_at)))}function m(e,t){const n=b[e];n&&(n.textContent=t??"—")}function B(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function j(e,t=1){if(!window.Swal)return Promise.resolve(confirm(l.i18n.confirmDelete));const n=l.confirm||{},r=e==="bulk"?n.bulkTitle:n.deleteTitle;let i=e==="bulk"?n.bulkMessage:n.deleteMessage;return e==="bulk"&&(i=i?.replace(":count",t)),Swal.fire({title:r,text:i,icon:"warning",showCancelButton:!0,confirmButtonText:n.confirm||"OK",cancelButtonText:n.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(c=>c.isConfirmed)}function S(){const e=d.find(".banner-select"),t=d.find(".banner-select:checked");y&&(y.checked=t.length>0&&t.length===e.length,y.indeterminate=t.length>0&&t.length<e.length),x&&(x.disabled=s.size===0)}function E(e={},t=null){if(e&&typeof e=="object"){if(e[C])return e[C];const n=document.documentElement.dataset.fallbackLocale||"en";if(e[n])return e[n];const r=Object.values(e).find(Boolean);if(r)return r}return t}function M(e){return`<i class="ki-outline ${e} fs-2"></i>`}});
