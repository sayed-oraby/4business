import{a as E}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{W(),G()});function W(){const e=window.ProductModule||{},a=$("#products-table");if(!a.length)return;const d=document.head.querySelector('meta[name="csrf-token"]')?.content,c=document.getElementById("select-all-products"),u=document.getElementById("bulk-delete-btn"),v=document.getElementById("product-search"),m=e.actions||{},o={status:"",state:"active",featured:"",new_arrival:"",trending:""},f=new Set,g=a.DataTable({processing:!0,serverSide:!0,order:[],ajax:(t,r)=>{const l={draw:t.draw,start:t.start,length:t.length,"search[value]":t.search?.value,"order[0][column]":t.order?.[0]?.column,"order[0][dir]":t.order?.[0]?.dir,status:o.status,state:o.state};o.featured!==""&&(l.featured=o.featured),o.new_arrival!==""&&(l.new_arrival=o.new_arrival),o.trending!==""&&(l.trending=o.trending),E.get(e.routes.data,{params:l}).then(p=>r(p.data)).catch(()=>r({data:[],recordsTotal:0,recordsFiltered:0,draw:t.draw}))},columnDefs:[{targets:0,orderable:!1,className:"text-center align-middle"},{targets:-1,orderable:!1,className:"text-end"}],columns:[{data:"id",render:t=>`
                    <div class="form-check form-check-sm form-check-custom">
                        <input class="form-check-input product-select" type="checkbox" value="${t}">
                    </div>
                `},{data:null,render:(t,r,l)=>{const p=C(l.title_translations,l.title)??"—",_=l.image_url??"",k=l.category?.title??"",T=l.brand?.title??"",x=[k,T].filter(Boolean).join(" • ")||"—";return`
                        <div class="d-flex align-items-center">
                            <div class="symbol symbol-50px me-4">
                                <span class="symbol-label bg-light">
                                    <img src="${_}" class="product-thumb" alt="${p??""}">
                                </span>
                            </div>
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-gray-900">${p}</span>
                                <span class="text-muted fs-8">${x}</span>
                            </div>
                        </div>
                    `}},{data:"sku",render:t=>`<span class="fw-semibold">${t??"—"}</span>`},{data:"price",render:t=>`<span class="fw-semibold text-gray-900">${J(t)}</span>`},{data:null,render:(t,r,l)=>{const p=l.status==="active"?"badge-light-success":l.status==="draft"?"badge-light-warning":"badge-light-secondary",_=e.statusLabels?.[l.status]??l.status_label??l.status;return`<span class="badge ${p}">${_}</span>`}},{data:null,render:(t,r,l)=>{const p=[];return l.is_featured&&p.push(`<span class="badge badge-light-primary product-flag-badge">${L("ki-star")} ${e.flags?.featured??"Featured"}</span>`),l.is_new_arrival&&p.push(`<span class="badge badge-light-info product-flag-badge">${L("ki-verify")} ${e.flags?.new_arrival??"New"}</span>`),l.is_trending&&p.push(`<span class="badge badge-light-warning product-flag-badge">${L("ki-activity")} ${e.flags?.trending??"Trending"}</span>`),p.length?p.join(""):'<span class="text-muted">—</span>'}},{data:"qty",render:t=>`<span class="fw-semibold">${Number.isFinite(t)?t:0}</span>`},{data:"updated_at",render:t=>`<span class="text-muted fw-semibold">${Q(t)}</span>`},{data:null,render:t=>{const r=[];return e.can?.update&&r.push(`
                            <button class="btn btn-sm btn-icon btn-light-primary" data-product-action="edit" title="${m.edit??"Edit"}" data-id="${t.id}">
                                ${L("ki-pencil")}
                            </button>
                        `),e.can?.delete&&r.push(`
                            <button class="btn btn-sm btn-icon btn-light-danger" data-product-action="delete" title="${m.delete??"Delete"}" data-id="${t.id}">
                                ${L("ki-trash")}
                            </button>
                        `),`<div class="d-flex justify-content-center gap-2">${r.join("")}</div>`}}],drawCallback:()=>{a.find(".product-select").each(function(){this.checked=f.has(this.value)}),s()}});v?.addEventListener("keyup",t=>{g.search(t.target.value).draw()}),["status","state","featured","new_arrival","trending"].forEach(t=>{document.querySelectorAll(`[data-product-filter="${t}"]`).forEach(r=>{r.addEventListener("change",l=>{o[t]=l.target.value,t==="state"&&!o.state&&(o.state="active")})})}),document.querySelector("[data-filter-apply]")?.addEventListener("click",()=>{g.ajax.reload()}),document.querySelector("[data-filter-reset]")?.addEventListener("click",()=>{o.status="",o.state="active",o.featured="",o.new_arrival="",o.trending="",document.querySelectorAll("[data-product-filter]").forEach(t=>{t.getAttribute("data-product-filter")==="state"?t.value="active":t.value=""}),g.ajax.reload()}),a.on("change",".product-select",function(){const t=String(this.value);t&&(this.checked?f.add(t):f.delete(t),s())}),c?.addEventListener("change",()=>{const t=c.checked;a.find(".product-select").each(function(){this.checked=t;const r=String(this.value);r&&(t?f.add(r):f.delete(r))}),s()}),a.on("click",'[data-product-action="edit"]',function(){const t=this.getAttribute("data-id");if(!t)return;const r=e.routes.edit?.replace("__ID__",t);r&&(window.location.href=r)}),a.on("click",'[data-product-action="delete"]',function(){const t=this.getAttribute("data-id");t&&j("single",1,e.confirm).then(r=>{r&&E.post(e.routes.destroy.replace("__ID__",t),{_method:"DELETE"},{headers:{"X-CSRF-TOKEN":d}}).then(()=>{b(e.messages?.deleted??"Deleted"),f.delete(t),g.ajax.reload(null,!1),s()}).catch(()=>b("Error",!0))})}),u?.addEventListener("click",()=>{f.size&&j("bulk",f.size,e.confirm).then(t=>{t&&E.post(e.routes.bulkDestroy,{ids:Array.from(f),_method:"DELETE"},{headers:{"X-CSRF-TOKEN":d}}).then(()=>{b(e.messages?.bulkDeleted??"Deleted"),f.clear(),g.ajax.reload(),s()}).catch(()=>b("Error",!0))})});function s(){const t=a.find(".product-select"),r=a.find(".product-select:checked");c&&(c.checked=r.length>0&&r.length===t.length,c.indeterminate=r.length>0&&r.length<t.length),u&&(u.disabled=f.size===0)}}function G(){const e=window.ProductForm||{},a=document.getElementById("productForm");if(!a||Object.keys(e).length===0)return;const d=document.querySelector("[data-product-submit]"),c=a.querySelector("[data-product-errors]"),u=document.querySelectorAll("[data-product-locale-tab]"),v=$("[data-product-tags]"),m=$("[data-product-category]"),o=$("[data-product-brand]"),f=document.getElementById("productTagModal"),g=f?new bootstrap.Modal(f):null,s=document.getElementById("productTagForm"),t=document.querySelector("[data-product-dropzone]"),r=t?.querySelector("[data-product-dropzone-previews]"),l=t?.querySelector("[data-product-dropzone-message]"),p=document.getElementById("productDropzonePreviewTemplate")?.innerHTML,_=document.head.querySelector('meta[name="csrf-token"]')?.content;let k=null,T=!1;const x=a.querySelector('input[name="gallery_token"]');let I=x?.value||e.galleryToken||V();x&&(x.value=I);const D=e.productId||null;let F=0;R(),P(),K(),U(),A(),H();function A(){a.addEventListener("submit",n=>{n.preventDefault(),M()}),s?.addEventListener("submit",n=>{n.preventDefault(),O()})}function M(){if(T)return;const n=e.mode==="edit",i=n?D:null,h=n?e.routes.update?.replace("__ID__",i):e.routes.store;if(!h)return;T=!0,z(!0),ee(a,{summaryEl:c,localeTabs:u});const y=new FormData(a);y.set("_method",n?"PUT":"POST"),y.set("gallery_token",I),E.post(h,y,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":_}}).then(({data:w})=>{const N=w?.data?.product;if(!N){b(e.messages?.updated??"Saved");return}if(e.mode==="create"){const q=e.routes.edit?.replace("__ID__",N.id);q?window.location.href=q:e.routes.index?window.location.href=e.routes.index:b(e.messages?.created??"Created")}else b(e.messages?.updated??"Updated")}).catch(w=>te(w,a,{summaryEl:c,localeTabs:u})).finally(()=>{T=!1,z(!1)})}function O(){if(!s)return;const n=new FormData(s);E.post(e.routes.tagsStore,n,{headers:{"X-CSRF-TOKEN":_}}).then(({data:i})=>{const h=i?.data?.tag;if(!h)return;const y=new Option(C(h.title_translations,h.title),h.id,!0,!0);v.append(y).trigger("change"),s.reset(),g?.hide(),b(e.messages?.tagCreated??"Tag created.")}).catch(i=>{const h=i.response?.data?.message??"Failed to create tag.";b(h,!0)})}function R(){v.length&&v.select2({placeholder:v.data("placeholder")||"",allowClear:!0,ajax:{url:e.routes.tagsIndex,dataType:"json",delay:200,data:n=>({search:n.term}),processResults:n=>({results:(n.tags||[]).map(i=>({id:i.id,text:C(i.title_translations,i.title)}))})}})}function P(){m.length&&m.select2({placeholder:m.data("placeholder")||"",allowClear:!0,ajax:{url:e.routes.categories,dataType:"json",delay:200,data:n=>({search:n.term}),processResults:n=>({results:(n.results||[]).map(i=>({id:i.id,text:i.text??i.title}))})}})}function K(){o.length&&o.select2({placeholder:o.data("placeholder")||"",allowClear:!0,ajax:{url:e.routes.brands,dataType:"json",delay:200,data:n=>({search:n.term}),processResults:n=>({results:(n.results||[]).map(i=>({id:i.id,text:i.text??i.title}))})}})}function U(){const n=window.Dropzone;!n||!t||(n.autoDiscover=!1,k=new n(t,{url:e.routes.galleryUpload,paramName:"file",headers:{"X-CSRF-TOKEN":_},maxFilesize:e.upload?.maxFileSize??5,acceptedFiles:"image/*",addRemoveLinks:!1,previewsContainer:r||t,previewTemplate:p||void 0,init(){this.on("sending",(i,h,y)=>{y.append("upload_token",I),D&&y.append("product_id",D)}),this.on("success",(i,h)=>{i._galleryId=h?.gallery?.id,S()}),this.on("addedfile",()=>S()),this.on("error",()=>b("Upload failed",!0)),this.on("removedfile",i=>{if(!i._galleryId){S();return}E.delete(e.routes.galleryDestroy.replace("__ID__",i._galleryId),{headers:{"X-CSRF-TOKEN":_}}).then(()=>b(e.messages?.galleryDeleted??"Image removed.")).catch(()=>b("Failed to delete image.",!0)).finally(()=>S())})}}),D&&X(D))}function X(n){if(!k)return;const i=++F;k.removeAllFiles(!0),r&&(r.innerHTML=""),S(),E.get(e.routes.galleryIndex.replace("__ID__",n)).then(({data:h})=>{i===F&&((h.gallery||[]).forEach(y=>{const w={name:`gallery-${y.id}`,size:1,accepted:!0,_galleryId:y.id};k.emit("addedfile",w),k.emit("thumbnail",w,y.image_url),k.emit("complete",w)}),S())})}function S(){if(!l||!k)return;const n=k.getAcceptedFiles().length+k.getQueuedFiles().length;l.classList.toggle("d-none",n>0)}function H(){document.querySelector('[data-product-action="open-tag-modal"]')?.addEventListener("click",()=>{s?.reset(),g?.show()})}function z(n){d&&(d.disabled=n,d.dataset.ktIndicator=n?"on":"off")}}function j(e,a=1,d={}){const{deleteTitle:c="Delete item",deleteMessage:u="Are you sure you want to delete this item?",bulkTitle:v="Delete items",bulkMessage:m="Delete :count items?",confirm:o="Confirm",cancel:f="Cancel"}=d;if(!window.Swal){const t=e==="bulk"?(m||"").replace(":count",a):u;return Promise.resolve(window.confirm(t||"Are you sure?"))}const g=e==="bulk"?v:c;let s=e==="bulk"?m:u;return e==="bulk"&&(s=(s||"").replace(":count",a)),Swal.fire({title:g,text:s,icon:"warning",showCancelButton:!0,confirmButtonText:o,cancelButtonText:f,customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(t=>t.isConfirmed)}function b(e,a=!1){window.toastr?a?toastr.error(e):toastr.success(e):a?alert(e):console.log(e)}function C(e={},a=null){if(e&&typeof e=="object"){const d=document.documentElement.lang||"en";if(e[d])return e[d];const c=document.documentElement.dataset.fallbackLocale||"en";if(e[c])return e[c];const u=Object.values(e).find(Boolean);if(u)return u}return a}function Q(e){if(!e)return"—";const a=new Date(e);return Number.isNaN(a.getTime())?e:a.toLocaleString()}function J(e){const a=Number(e);return Number.isNaN(a)?"—":a.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function L(e){return`<i class="ki-outline ${e} fs-2"></i>`}function V(){return`${Math.random().toString(36).slice(2)}${Date.now().toString(36)}`}function Y(e){return e.replace(/\.(\w+)/g,"[$1]")}function Z(e){return window.CSS?.escape?CSS.escape(e):e.replace(/([ #;?%&,.+*~\\':"!^$[\]()=>|/@])/g,"\\$1")}function ee(e,{summaryEl:a,localeTabs:d}={}){e&&(e.querySelectorAll(".is-invalid").forEach(c=>c.classList.remove("is-invalid")),e.querySelectorAll(".invalid-feedback").forEach(c=>c.remove()),a&&B(a),d&&re(d))}function te(e,a,{summaryEl:d,localeTabs:c}={}){if(!a)return;const u=new Set,v=e.response?.data?.errors;v?Object.entries(v).forEach(([m,o])=>{const f=Y(m),g=a.querySelector(`[name="${Z(f)}"]`);if(g){g.classList.add("is-invalid");let s=g.nextElementSibling;(!s||!s.classList.contains("invalid-feedback"))&&(s=document.createElement("div"),s.className="invalid-feedback",g.parentNode?.appendChild(s)),s.textContent=o[0]}if(o.forEach(s=>u.add(s)),(m.startsWith("title.")||m.startsWith("description."))&&c){const s=m.split(".")[1];ne(c,s)}}):e.response?.data?.message?u.add(e.response.data.message):u.add("Something went wrong."),d?ae(d,Array.from(u)):Array.from(u).forEach(m=>b(m,!0))}function ae(e,a){if(!e||!a.length){B(e);return}e.classList.remove("d-none"),e.innerHTML="";const d=document.createElement("ul");a.forEach(c=>{const u=document.createElement("li");u.textContent=c,d.appendChild(u)}),e.appendChild(d)}function B(e){e&&(e.classList.add("d-none"),e.innerHTML="")}function ne(e,a){e?.forEach(d=>{d.dataset.locale===a&&d.classList.add("product-locale-invalid")})}function re(e){e?.forEach(a=>a.classList.remove("product-locale-invalid"))}
