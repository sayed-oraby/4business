import{a as h}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const s=window.OrderDashboard;if(!s)return;const p=$("#orders-table"),d=document.getElementById("orders-search"),o=document.getElementById("orders-status-filter"),l=document.getElementById("orders-payment-filter"),g=document.querySelector("[data-filter-apply]"),v=document.querySelector("[data-filter-reset]");let f,n={search:"",status:"",payment_status:""};y(),_(),i();function y(){f=p.DataTable({order:[],pageLength:10,columns:[{data:"id"},{data:"user_id",render:(t,a,e)=>e.user_id?`#${e.user_id}`:e.guest_uuid??"Guest"},{data:"grand_total",render:(t,a,e)=>`${e.grand_total} ${e.currency}`},{data:"status",render:(t,a,e)=>{const r=e.status_color??"#f6f8fb",c=e.status??"—";return`<span class="badge rounded-1" style="background:${r};color:#111;">${c}</span>`}},{data:null,render:(t,a,e)=>`<span class="badge badge-light-info">${e.payment_status_label||e.payment_status||"—"}</span>`},{data:"created_at"},{data:null,orderable:!1,className:"text-center",render:t=>I(t)}]})}function _(){d?.addEventListener("keyup",E(()=>{n.search=d.value,i()},300)),o?.addEventListener("change",()=>{n.status=o.value}),l?.addEventListener("change",()=>{n.payment_status=l.value}),g?.addEventListener("click",()=>{n.search=d?.value||"",n.status=o?.value||"",n.payment_status=l?.value||"",i(),bootstrap.Offcanvas.getInstance(document.getElementById("orderFiltersCanvas"))?.hide()}),v?.addEventListener("click",()=>{n.search="",n.status="",n.payment_status="",d&&(d.value=""),o&&(o.value=""),l&&(l.value=""),i(),bootstrap.Offcanvas.getInstance(document.getElementById("orderFiltersCanvas"))?.hide()})}function i(){h.get(s.routes.data,{params:n}).then(({data:t})=>{const a=t?.data?.orders?.data??[];f.clear().rows.add(a).draw()})}function m(t){return`<i class="ki-outline ${t} fs-2"></i>`}function I(t){const a=[],e=t.payments?.[0]?.invoice_url,r=s.labels?.statuses??[];if(a.push(`
            <a class="btn btn-sm btn-icon btn-light-primary" href="${s.routes?.show?.replace("__ID__",t.id)||`/dashboard/orders/${t.id}`}" title="${s.labels?.view||"View"}">
                ${m("ki-eye")}
            </a>
        `),e&&a.push(`
                <a class="btn btn-sm btn-icon btn-light-info" href="${e}" target="_blank" rel="noopener" title="${s.labels?.viewInvoice||"View Invoice"}">
                    ${m("ki-link")}
                </a>
            `),s.can?.update){const c=r.map(u=>`
                <option value="${u.id}" ${t.order_status_id===u.id?"selected":""}>${u.title}</option>
            `).join("");a.push(`
                <select class="form-select form-select-sm w-auto order-status-select" data-order-id="${t.id}" title="${s.labels.changeStatus}">
                    ${c}
                </select>
            `)}return a.length?`<div class="d-flex justify-content-center gap-2">${a.join("")}</div>`:"—"}function E(t,a){let e;return(...r)=>{clearTimeout(e),e=setTimeout(()=>t(...r),a)}}p.on("change",".order-status-select",function(){const t=this.dataset.orderId,a=this.value;!t||!a||h.post(s.routes.changeStatus.replace("__ID__",t),{status_id:a}).then(()=>{i(),b("success",s.messages?.statusChanged??"Status updated")}).catch(e=>{console.error(e),b("error",e.response?.data?.message??s.messages?.statusChangeFailed??"Unable to update status")})});function b(t,a){if(window.toastr){toastr[t](a);return}alert(a)}});
