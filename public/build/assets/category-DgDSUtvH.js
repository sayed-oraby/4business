import{a as S}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const o=window.CategoryModule||{},d=$("#categories-table");if(!d.length)return;const q=o.locale||document.documentElement.lang||"en",r=document.getElementById("categoryForm"),C=document.getElementById("categoryFormModal"),k=C?new bootstrap.Modal(C):null,h=document.getElementById("select-all-categories"),u=$("[data-category-parent]"),f=r?.querySelector("[data-category-errors]"),B=document.querySelectorAll("[data-category-locale-tab]"),_=document.head.querySelector('meta[name="csrf-token"]')?.content,x=document.querySelector('[data-category-action="submit-form"]'),R=document.getElementById("category-filter-form"),K=document.querySelector("[data-filter-apply]"),X=document.querySelector("[data-filter-reset]"),A="category-locale-invalid",l={status:"",state:"active",featured:""},c=new Set;let L=!1;H();const i=d.DataTable({processing:!0,serverSide:!0,order:[],ajax:(e,t)=>{const a={draw:e.draw,start:e.start,length:e.length,"search[value]":e.search?.value,"order[0][column]":e.order?.[0]?.column,"order[0][dir]":e.order?.[0]?.dir,status:l.status,state:l.state};l.featured!==""&&(a.featured=l.featured),S.get(o.routes.data,{params:a}).then(n=>t(n.data)).catch(()=>t({data:[],recordsTotal:0,recordsFiltered:0,draw:e.draw}))},columnDefs:[{targets:0,orderable:!1,className:"text-center align-middle"},{targets:-1,orderable:!1,className:"text-end"}],columns:[{data:"id",render:e=>`
                    <div class="form-check form-check-sm form-check-custom">
                        <input class="form-check-input category-select" type="checkbox" value="${e}">
                    </div>
                `},{data:null,render:(e,t,a)=>{const n=T(a.title_translations,a.title),s=a.parent?T(a.parent.title_translations,a.parent.title):null;return`
                        <div class="d-flex align-items-center">
                            <img src="${a.image_url??""}" class="category-thumb me-4" alt="${n??""}">
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-gray-900">${n??"—"}</span>
                                <span class="text-muted fs-8">${s??"—"}</span>
                            </div>
                        </div>
                    `}},{data:"status_label",render:(e,t,a)=>`<span class="badge ${a.status==="active"?"badge-light-success":a.status==="draft"?"badge-light-warning":"badge-light-secondary"}">${e}</span>`},{data:"parent",render:e=>e?T(e.title_translations,e.title)??"—":"—"},{data:"is_featured",render:(e,t,a)=>{if(!e)return`<span class="badge badge-light">${o.labels?.no??"No"}</span>`;const n=Number(a.featured_order)||0,s=n>0?`#${n}`:"";return`
                        <span class="badge badge-light-primary category-featured-badge">
                            <i class="ki-duotone ki-star fs-5"></i>
                            ${o.labels?.yes??"Yes"} ${s}
                        </span>
                    `}},{data:"updated_at",render:e=>`<span class="text-muted fw-semibold">${Z(e)}</span>`},{data:null,render:e=>{const t=[];return o.can?.update&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-primary" data-category-action="edit" data-id="${e.id}" title="${o.i18n.edit}">
                                ${M("ki-pencil")}
                            </button>
                        `),o.can?.delete&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-danger" data-category-action="delete" data-id="${e.id}" title="${o.i18n.delete}">
                                ${M("ki-trash")}
                            </button>
                        `),`<div class="d-flex justify-content-end gap-2">${t.join("")}</div>`}}],drawCallback:()=>{d.find(".category-select").each(function(){this.checked=c.has(this.value)}),y()}});let I;document.getElementById("category-search")?.addEventListener("keyup",e=>{clearTimeout(I),I=setTimeout(()=>{i.search(e.target.value).draw()},500)}),document.querySelectorAll('[data-category-filter="status"]').forEach(e=>{e.addEventListener("change",t=>{l.status=t.target.value,i.ajax.reload()})}),document.querySelectorAll('[data-category-filter="state"]').forEach(e=>{e.addEventListener("change",t=>{l.state=t.target.value||"active",i.ajax.reload()})}),document.querySelectorAll('[data-category-filter="featured"]').forEach(e=>{e.addEventListener("change",t=>{l.featured=t.target.value,i.ajax.reload()})}),document.querySelectorAll('[data-category-action="open-form"]').forEach(e=>{e.addEventListener("click",()=>{j(),k?.show()})}),d.on("click",'[data-category-action="edit"]',function(){const e=i.row($(this).closest("tr")).data();e&&(V(e),k?.show())}),d.on("click",'[data-category-action="delete"]',function(){const e=this.getAttribute("data-id");e&&F("single").then(t=>{t&&S.post(o.routes.destroy.replace("__ID__",e),{_method:"DELETE"},{headers:{"X-CSRF-TOKEN":_}}).then(()=>{g(o.messages.deleted),c.delete(e),i.ajax.reload(null,!1),y()}).catch(()=>g("Error",!0))})}),d.on("change",".category-select",function(){const e=String(this.value);e&&(this.checked?c.add(e):c.delete(e),y())}),h?.addEventListener("change",()=>{const e=h.checked;d.find(".category-select").each(function(){this.checked=e;const t=String(this.value);t&&(e?c.add(t):c.delete(t))}),y()}),document.getElementById("bulk-delete-btn")?.addEventListener("click",()=>{c.size!==0&&F("bulk",c.size).then(e=>{e&&S.post(o.routes.bulkDestroy,{ids:Array.from(c),_method:"DELETE"},{headers:{"X-CSRF-TOKEN":_}}).then(()=>{g(o.messages.bulkDeleted),c.clear(),i.ajax.reload(),y()}).catch(()=>g("Error",!0))})}),r?.addEventListener("submit",e=>{e.preventDefault(),U()}),document.querySelector('[data-category-action="submit-form"]')?.addEventListener("click",()=>{r?.requestSubmit()});function H(){u.length&&u.select2({dropdownParent:$("#categoryFormModal"),placeholder:u.data("placeholder")||"",allowClear:!0,ajax:{url:o.routes.parents,dataType:"json",delay:250,data:e=>({search:e.term,exclude:r?.querySelector('input[name="category_id"]')?.value}),processResults:e=>({results:e.results??[]})}})}function j(){if(!r)return;r.reset(),N(r),r.querySelector('input[name="category_id"]').value="",r.querySelector('input[name="_method"]').value="POST",u.val(null).trigger("change");const e=r.querySelector('input[name="is_featured"]');e&&(e.checked=!1)}function V(e){if(!r)return;j();const t=r.querySelector('input[name="category_id"]'),a=r.querySelector('input[name="_method"]');t&&(t.value=e.id),a&&(a.value="PUT"),E('select[name="status"]',e.status??"draft"),E('input[name="position"]',e.position??0),E('input[name="featured_order"]',e.featured_order??0);const n=r.querySelector('input[name="is_featured"]');n&&(n.checked=!!e.is_featured),Object.entries(e.title_translations??{}).forEach(([s,m])=>{E(`input[name="title[${s}]"]`,m)}),e.parent?(te(e.parent),u.val(String(e.parent.id)).trigger("change")):u.val(null).trigger("change")}function E(e,t){if(!r)return;const a=r.querySelector(e);a&&(a.value=t??"")}function U(){if(!r||L)return;L=!0,O(!0);const e=r.querySelector('input[name="category_id"]')?.value,t=!!e,a=new FormData(r),n=t?o.routes.update.replace("__ID__",e):o.routes.store;t||a.set("_method","POST"),N(r),S.post(n,a,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":_}}).then(()=>{k?.hide(),i.ajax.reload(null,!1),g(t?o.messages.updated:o.messages.created)}).catch(s=>Y(s,r)).finally(()=>{L=!1,O(!1)})}function N(e){const t=e??r;t&&(t.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),t.querySelectorAll(".invalid-feedback").forEach(a=>{a.textContent="",a.style.display="none"}),t.querySelectorAll("[data-error-for]").forEach(a=>{a.textContent="",a.style.display="none"}),(!e||t===r)&&(D(),W()))}function Y(e,t){const a=t??r;if(!a)return;const n=new Set;e.response?.status===422&&e.response?.data?.errors?(Object.entries(e.response.data.errors).forEach(([s,m])=>{const w=Array.isArray(m)?m[0]:m;n.add(w);const P=ee(s),p=a.querySelector(`[name="${P}"]`);let b=a.querySelector(`[data-error-for="${s}"]`);if(b||(b=a.querySelector(`[data-error-for="${P}"]`)),p&&p.classList.add("is-invalid"),b)b.textContent=w,b.style.display="block";else if(p){let v=p.parentNode.querySelector(".invalid-feedback");v||(v=document.createElement("div"),v.classList.add("invalid-feedback"),p.parentNode.appendChild(v)),v.textContent=w}const z=J(s);z&&Q(z)}),G(Array.from(n))):g("Error",!0)}function G(e){if(!f)return;if(!e.length){D();return}f.innerHTML="";const t=document.createElement("ul");e.forEach(a=>{const n=document.createElement("li");n.textContent=a,t.appendChild(n)}),f.appendChild(t),f.classList.remove("d-none")}function D(){f&&(f.classList.add("d-none"),f.innerHTML="")}function J(e){const t=e.match(/title\.(\w+)$/);return t?t[1]:null}function Q(e){B.forEach(t=>{t.dataset.locale===e&&t.classList.add(A)})}function W(){B.forEach(e=>e.classList.remove(A))}function y(){const e=d.find(".category-select"),t=d.find(".category-select:checked");h&&(h.checked=t.length>0&&t.length===e.length,h.indeterminate=t.length>0&&t.length<e.length);const a=document.getElementById("bulk-delete-btn");a&&(a.disabled=c.size===0)}function F(e,t=1){if(!window.Swal)return Promise.resolve(confirm(o.confirm?.deleteMessage??"Are you sure?"));const a=o.confirm||{},n=e==="bulk"?a.bulkTitle:a.deleteTitle;let s=e==="bulk"?a.bulkMessage:a.deleteMessage;return e==="bulk"&&(s=s?.replace(":count",t)),Swal.fire({title:n,text:s,icon:"warning",showCancelButton:!0,confirmButtonText:a.confirm||"OK",cancelButtonText:a.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(m=>m.isConfirmed)}function g(e,t=!1){window.toastr?t?toastr.error(e):toastr.success(e):alert(e)}function T(e={},t=null){if(e&&typeof e=="object"){if(e[q])return e[q];const a=document.documentElement.dataset.fallbackLocale||"en";if(e[a])return e[a];const n=Object.values(e).find(Boolean);if(n)return n}return t}function Z(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function M(e){return`<i class="ki-outline ${e} fs-2"></i>`}function ee(e){return e.replace(/\.(\w+)/g,"[$1]")}function te(e){if(!e||!u.length)return;if(!Array.from(u[0].options).some(a=>Number(a.value)===Number(e.id))){const a=new Option(e.title??"-",e.id,!1,!1);u.append(a)}}function O(e){x&&(x.disabled=e,x.dataset.ktIndicator=e?"on":"off")}K?.addEventListener("click",()=>{i.ajax.reload(),bootstrap.Offcanvas.getInstance(document.getElementById("categoryFiltersCanvas"))?.hide()}),X?.addEventListener("click",()=>{R?.reset(),l.status="",l.state="active",l.featured="",i.ajax.reload()})});
