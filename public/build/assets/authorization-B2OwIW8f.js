import{a as l}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const s=window.AuthorizationConfig,c=$("#roles-table");if(!s||!c.length)return;let i={},f=null;const v=c.DataTable({processing:!0,serverSide:!0,ajax:s.urls.data,columns:[{data:"name"},{data:"guard_name"},{data:"users_count"},{data:null,orderable:!1,className:"text-end",render:e=>C(e)}]});function C(e){const t=[`<button class="btn btn-sm btn-light select-role" data-id="${e.id}" data-name="${e.name}">
                <i class="ki-outline ki-setting-4"></i>
            </button>`];return s.canUpdate&&(t.push(`<button class="btn btn-sm btn-light-primary edit-role" data-id="${e.id}" data-name="${e.name}">
                <i class="ki-outline ki-pencil"></i>
            </button>`),e.name!=="super-admin"&&t.push(`<button class="btn btn-sm btn-light-danger delete-role" data-id="${e.id}">
                    <i class="ki-outline ki-trash"></i>
                </button>`)),`<div class="d-flex justify-content-end gap-2">${t.join("")}</div>`}function u(e,t){return e.replace("__id__",t)}function k(){return Object.keys(i).length?Promise.resolve(i):l.get(s.urls.availablePermissions).then(({data:e})=>(i=e.permissions||{},i))}function E(e=[]){const t=$("[data-permission-groups]");t.empty();const n=e.map(o=>typeof o=="string"?o:o.name);Object.entries(i).forEach(([o,a])=>{const d=$('<div class="mb-5"></div>'),m=a.module_label||o,b=a.permissions||a;d.append(`<h5 class="fw-semibold text-gray-800 mb-3 text-uppercase">${m}</h5>`);const y=$('<div class="row g-3"></div>');(Array.isArray(b)?b:Object.values(b)).forEach(r=>{const g=typeof r=="string"?r:r.name,D=typeof r=="string"?r:r.label??r.name;`${g.replace(".","_")}`,y.append(`
                    <div class="col-md-6">
                        <label class="form-check form-check-custom form-check-solid">
                            <input class="form-check-input" type="checkbox" value="${g}" name="permissions[]"
                                ${n.includes(g)?"checked":""}>
                            <span class="form-check-label">${D}</span>
                        </label>
                    </div>
                `)}),d.append(y),t.append(d)})}c.on("click",".select-role",function(){const e=$(this).data("id");f=e,k().then(()=>{l.get(u(s.urls.permissions,e)).then(({data:t})=>{$("[data-role-placeholder]").addClass("d-none"),$("#role-permissions-form").removeClass("d-none"),$("#permissions_role_id").val(e),E(t.permissions||[])})})});const x=$("#role-permissions-form");x.length&&x.on("submit",function(e){e.preventDefault();const t=$("#permissions_role_id").val(),n=$(this).serialize();l.post(u(s.urls.syncPermissions,t),n).then(()=>showSuccess(s.messages?.permissionsSynced||"Saved")).catch(()=>showError("Unable to sync permissions"))});const p=document.getElementById("role-form");p&&($("#role-form").on("submit",function(e){e.preventDefault();const t=e.currentTarget,n=$("#role_id").val(),o=!!n,a=new FormData(t),d=o?u(s.urls.update,n):s.urls.store;o&&a.append("_method","PUT"),h(t),l.post(d,a).then(()=>{$("#roleModal").modal("hide"),t.reset(),v.ajax.reload(null,!1);const m=n?s.messages?.roleUpdated:s.messages?.roleCreated;showSuccess(m||"Saved")}).catch(m=>_(t,m))}),c.on("click",".edit-role",function(){$("#role_id").val($(this).data("id")),$("#role_name").val($(this).data("name")),$("[data-role-modal-title]").text(s.labels?.edit||"Edit Role"),$("#roleModal").modal("show")}),$("#roleModal").on("hidden.bs.modal",()=>{p.reset(),h(p),$("#role_id").val(""),$("[data-role-modal-title]").text(s.labels?.create||"Create Role")}),c.on("click",".delete-role",function(){const e=$(this).data("id");w().then(t=>{t&&l.delete(u(s.urls.delete,e)).then(()=>{v.ajax.reload(null,!1),showSuccess(s.messages?.roleDeleted||"Deleted")}).catch(n=>{const o=n.response?.data?.message??"Unable to delete role";showError(o)})})}),$("#permission-form").on("submit",function(e){e.preventDefault();const t=e.currentTarget,n=$(t).serialize();h(t),l.post(s.urls.createPermission,n).then(()=>{$("#permissionModal").modal("hide"),t.reset(),i={},k().then(()=>{f&&$(`.select-role[data-id="${f}"]`).trigger("click")}),showSuccess(s.messages?.permissionCreated||"Created")}).catch(o=>_(t,o))}));function h(e){$(e).find(".is-invalid").removeClass("is-invalid"),$(e).find("[data-error-for]").text("")}function _(e,t){t.response?.status===422?Object.entries(t.response.data.errors||{}).forEach(([n,o])=>{$(e).find(`[name="${n}"]`).addClass("is-invalid"),$(e).find(`[data-error-for="${n}"]`).text(o[0])}):showError("Unexpected error occurred")}function w(){const e=s.confirm||{};return Swal.fire({title:e.title||"Delete role?",text:e.message||"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:e.confirm||"Yes, delete",cancelButtonText:e.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(t=>t.isConfirmed)}});
