import{a as i}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const s=window.AuthorizationConfig,c=$("#roles-table");if(!s||!c.length)return;let l={},u=null;const b=c.DataTable({processing:!0,serverSide:!0,ajax:s.urls.data,columns:[{data:"name"},{data:"guard_name"},{data:"users_count"},{data:null,orderable:!1,className:"text-end",render:e=>x(e)}]});function x(e){const t=[`<button class="btn btn-sm btn-light select-role" data-id="${e.id}" data-name="${e.name}">
                <i class="ki-outline ki-setting-4"></i>
            </button>`];return s.canUpdate&&(t.push(`<button class="btn btn-sm btn-light-primary edit-role" data-id="${e.id}" data-name="${e.name}">
                <i class="ki-outline ki-pencil"></i>
            </button>`),e.name!=="super-admin"&&t.push(`<button class="btn btn-sm btn-light-danger delete-role" data-id="${e.id}">
                    <i class="ki-outline ki-trash"></i>
                </button>`)),`<div class="d-flex justify-content-end gap-2">${t.join("")}</div>`}function d(e,t){return e.replace("__id__",t)}function g(){return Object.keys(l).length?Promise.resolve(l):i.get(s.urls.availablePermissions).then(({data:e})=>(l=e.permissions||{},l))}function _(e=[]){const t=$("[data-permission-groups]");t.empty(),Object.entries(l).forEach(([n,a])=>{const r=$('<div class="mb-5"></div>');r.append(`<h5 class="fw-semibold text-gray-800 mb-3 text-uppercase">${n}</h5>`);const m=$('<div class="row g-3"></div>');a.forEach(o=>{const h=typeof o=="string"?o:o.name,E=typeof o=="string"?o:o.label??o.name;`${h.replace(".","_")}`,m.append(`
                    <div class="col-md-6">
                        <label class="form-check form-check-custom form-check-solid">
                            <input class="form-check-input" type="checkbox" value="${h}" name="permissions[]"
                                ${e.includes(h)?"checked":""}>
                            <span class="form-check-label">${E}</span>
                        </label>
                    </div>
                `)}),r.append(m),t.append(r)})}c.on("click",".select-role",function(){const e=$(this).data("id");u=e,g().then(()=>{i.get(d(s.urls.permissions,e)).then(({data:t})=>{$("[data-role-placeholder]").addClass("d-none"),$("#role-permissions-form").removeClass("d-none"),$("#permissions_role_id").val(e),_(t.permissions||[])})})});const v=$("#role-permissions-form");v.length&&v.on("submit",function(e){e.preventDefault();const t=$("#permissions_role_id").val(),n=$(this).serialize();i.post(d(s.urls.syncPermissions,t),n).then(()=>showSuccess(s.messages?.permissionsSynced||"Saved")).catch(()=>showError("Unable to sync permissions"))});const f=document.getElementById("role-form");f&&($("#role-form").on("submit",function(e){e.preventDefault();const t=e.currentTarget,n=$("#role_id").val(),a=!!n,r=new FormData(t),m=a?d(s.urls.update,n):s.urls.store;a&&r.append("_method","PUT"),p(t),i.post(m,r).then(()=>{$("#roleModal").modal("hide"),t.reset(),b.ajax.reload(null,!1);const o=n?s.messages?.roleUpdated:s.messages?.roleCreated;showSuccess(o||"Saved")}).catch(o=>k(t,o))}),c.on("click",".edit-role",function(){$("#role_id").val($(this).data("id")),$("#role_name").val($(this).data("name")),$("[data-role-modal-title]").text(s.labels?.edit||"Edit Role"),$("#roleModal").modal("show")}),$("#roleModal").on("hidden.bs.modal",()=>{f.reset(),p(f),$("#role_id").val(""),$("[data-role-modal-title]").text(s.labels?.create||"Create Role")}),c.on("click",".delete-role",function(){const e=$(this).data("id");C().then(t=>{t&&i.delete(d(s.urls.delete,e)).then(()=>{b.ajax.reload(null,!1),showSuccess(s.messages?.roleDeleted||"Deleted")}).catch(n=>{const a=n.response?.data?.message??"Unable to delete role";showError(a)})})}),$("#permission-form").on("submit",function(e){e.preventDefault();const t=e.currentTarget,n=$(t).serialize();p(t),i.post(s.urls.createPermission,n).then(()=>{$("#permissionModal").modal("hide"),t.reset(),l={},g().then(()=>{u&&$(`.select-role[data-id="${u}"]`).trigger("click")}),showSuccess(s.messages?.permissionCreated||"Created")}).catch(a=>k(t,a))}));function p(e){$(e).find(".is-invalid").removeClass("is-invalid"),$(e).find("[data-error-for]").text("")}function k(e,t){t.response?.status===422?Object.entries(t.response.data.errors||{}).forEach(([n,a])=>{$(e).find(`[name="${n}"]`).addClass("is-invalid"),$(e).find(`[data-error-for="${n}"]`).text(a[0])}):showError("Unexpected error occurred")}function C(){const e=s.confirm||{};return Swal.fire({title:e.title||"Delete role?",text:e.message||"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonText:e.confirm||"Yes, delete",cancelButtonText:e.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(t=>t.isConfirmed)}});
