import{a as y}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const s=window.BrandModule||{},l=$("#brands-table");if(!l.length)return;const L=s.locale||document.documentElement.lang||"en",a=document.getElementById("brandForm"),q=document.getElementById("brandFormModal"),v=q?new bootstrap.Modal(q):null,S=document.querySelector('[data-brand-action="bulk-delete"]'),f=document.getElementById("select-all-brands"),i=a?.querySelector("[data-brand-errors]"),C=document.querySelectorAll("[data-brand-locale-tab]"),k=document.querySelector('[data-brand-action="submit-form"]'),w=document.head.querySelector('meta[name="csrf-token"]')?.content,A="brand-locale-invalid",E={status:"",state:"active"},o=new Set;let T=!1;const d=l.DataTable({processing:!0,serverSide:!0,order:[],ajax:(e,t)=>{const n={draw:e.draw,start:e.start,length:e.length,"search[value]":e.search?.value,"order[0][column]":e.order?.[0]?.column,"order[0][dir]":e.order?.[0]?.dir,status:E.status,state:E.state};y.get(s.routes.data,{params:n}).then(r=>t(r.data)).catch(()=>t({data:[],recordsTotal:0,recordsFiltered:0,draw:e.draw}))},columnDefs:[{targets:0,orderable:!1,className:"text-center align-middle"},{targets:-1,orderable:!1,className:"text-end"}],columns:[{data:"id",render:e=>`
                    <div class="form-check form-check-sm form-check-custom">
                        <input class="form-check-input brand-select" type="checkbox" value="${e}">
                    </div>
                `},{data:null,render:(e,t,n)=>{const r=U(n.title_translations,n.title);return`
                        <div class="d-flex align-items-center">
                            <img src="${n.image_url??""}" class="brand-thumb me-4" alt="${r??""}">
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-gray-900">${r??"—"}</span>
                                <span class="text-muted fs-8">${n.status_label??""}</span>
                            </div>
                        </div>
                    `}},{data:"status_label",render:(e,t,n)=>`<span class="badge ${n.status==="active"?"badge-light-success":n.status==="draft"?"badge-light-warning":"badge-light-secondary"}">${e}</span>`},{data:"position",render:e=>`<span class="fw-semibold">${e??0}</span>`},{data:"updated_at",render:e=>`<span class="text-muted fw-semibold">${V(e)}</span>`},{data:null,render:e=>{const t=[];return s.can?.update&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-primary" data-brand-action="edit" data-id="${e.id}" title="${s.actions?.edit??"Edit"}">
                                ${F("ki-pencil")}
                            </button>
                        `),s.can?.delete&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-danger" data-brand-action="delete" data-id="${e.id}" title="${s.actions?.delete??"Delete"}">
                                ${F("ki-trash")}
                            </button>
                        `),`<div class="d-flex justify-content-end gap-2">${t.join("")}</div>`}}],drawCallback:()=>{l.find(".brand-select").each(function(){this.checked=o.has(this.value)}),m()}});document.getElementById("brand-search")?.addEventListener("keyup",e=>{d.search(e.target.value).draw()}),document.querySelectorAll('[data-brand-filter="status"]').forEach(e=>{e.addEventListener("change",t=>{E.status=t.target.value,d.ajax.reload()})}),document.querySelectorAll('[data-brand-filter="state"]').forEach(e=>{e.addEventListener("change",t=>{E.state=t.target.value||"active",d.ajax.reload()})}),document.querySelectorAll('[data-brand-action="open-form"]').forEach(e=>{e.addEventListener("click",()=>{D(),v?.show()})}),l.on("click",'[data-brand-action="edit"]',function(){const e=d.row($(this).closest("tr")).data();e&&(z(e),v?.show())}),l.on("click",'[data-brand-action="delete"]',function(){const e=this.getAttribute("data-id");e&&j("single").then(t=>{t&&y.post(s.routes.destroy.replace("__ID__",e),{_method:"DELETE"},{headers:{"X-CSRF-TOKEN":w}}).then(()=>{u(s.messages.deleted),o.delete(e),d.ajax.reload(null,!1),m()}).catch(()=>u("Error",!0))})}),l.on("change",".brand-select",function(){const e=String(this.value);e&&(this.checked?o.add(e):o.delete(e),m())}),f?.addEventListener("change",()=>{const e=f.checked;l.find(".brand-select").each(function(){this.checked=e;const t=String(this.value);t&&(e?o.add(t):o.delete(t))}),m()}),S?.addEventListener("click",()=>{o.size!==0&&j("bulk",o.size).then(e=>{e&&y.post(s.routes.bulkDestroy,{ids:Array.from(o),_method:"DELETE"},{headers:{"X-CSRF-TOKEN":w}}).then(()=>{u(s.messages.bulkDeleted),o.clear(),d.ajax.reload(),m()}).catch(()=>u("Error",!0))})}),a?.addEventListener("submit",e=>{e.preventDefault(),K()});function D(){if(!a)return;a.reset(),I(a);const e=a.querySelector('input[name="brand_id"]'),t=a.querySelector('input[name="_method"]');e&&(e.value=""),t&&(t.value="POST")}function z(e){if(!a)return;D();const t=a.querySelector('input[name="brand_id"]'),n=a.querySelector('input[name="_method"]');t&&(t.value=e.id),n&&(n.value="PUT"),_('select[name="status"]',e.status??"draft"),_('input[name="position"]',e.position??0),Object.entries(e.title_translations??{}).forEach(([r,c])=>{_(`input[name="title[${r}]"]`,c)})}function _(e,t){if(!a)return;const n=a.querySelector(e);n&&(n.value=t??"")}function K(){if(!a||T)return;T=!0,M(!0);const e=a.querySelector('input[name="brand_id"]')?.value,t=!!e,n=new FormData(a),r=t?s.routes.update.replace("__ID__",e):s.routes.store;t||n.set("_method","POST"),I(a),y.post(r,n,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":w}}).then(()=>{v?.hide(),d.ajax.reload(null,!1),u(t?s.messages.updated:s.messages.created)}).catch(c=>P(c,a)).finally(()=>{T=!1,M(!1)})}function I(e){const t=e??a;t&&(t.querySelectorAll(".is-invalid").forEach(n=>n.classList.remove("is-invalid")),t.querySelectorAll(".invalid-feedback").forEach(n=>n.remove()),t.querySelectorAll("[data-error-for]").forEach(n=>{n.textContent="",n.style.display="none"}),(!e||t===a)&&(B(),X()))}function P(e,t){const n=t??a;if(!n)return;const r=new Set;e.response?.status===422&&e.response?.data?.errors?(Object.entries(e.response.data.errors).forEach(([c,h])=>{const x=Array.isArray(h)?h[0]:h;r.add(x);const N=G(c),b=n.querySelector(`[name="${N}"]`);let p=n.querySelector(`[data-error-for="${c}"]`);if(p||(p=n.querySelector(`[data-error-for="${N}"]`)),b&&b.classList.add("is-invalid"),p)p.textContent=x,p.style.display="block";else if(b){let g=b.parentNode.querySelector(".invalid-feedback");g||(g=document.createElement("div"),g.classList.add("invalid-feedback"),b.parentNode.appendChild(g)),g.textContent=x}const O=c.match(/title\.(\w+)$/);O&&H(O[1])}),R(Array.from(r))):u("Error",!0)}function R(e){if(!i)return;if(!e.length){B();return}i.innerHTML="";const t=document.createElement("ul");e.forEach(n=>{const r=document.createElement("li");r.textContent=n,t.appendChild(r)}),i.appendChild(t),i.classList.remove("d-none")}function B(){i&&(i.classList.add("d-none"),i.innerHTML="")}function X(){C.forEach(e=>e.classList.remove(A))}function H(e){C.forEach(t=>{t.dataset.locale===e&&t.classList.add(A)})}function m(){const e=l.find(".brand-select"),t=l.find(".brand-select:checked");f&&(f.checked=t.length>0&&t.length===e.length,f.indeterminate=t.length>0&&t.length<e.length),S&&(S.disabled=o.size===0)}function j(e,t=1){if(!window.Swal)return Promise.resolve(confirm(s.confirm?.deleteMessage??"Are you sure?"));const n=s.confirm||{},r=e==="bulk"?n.bulkTitle:n.deleteTitle;let c=e==="bulk"?n.bulkMessage:n.deleteMessage;return e==="bulk"&&(c=c?.replace(":count",t)),Swal.fire({title:r,text:c,icon:"warning",showCancelButton:!0,confirmButtonText:n.confirm||"OK",cancelButtonText:n.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(h=>h.isConfirmed)}function u(e,t=!1){window.toastr?t?toastr.error(e):toastr.success(e):alert(e)}function U(e={},t=null){if(e&&typeof e=="object"){if(e[L])return e[L];const n=document.documentElement.dataset.fallbackLocale||"en";if(e[n])return e[n];const r=Object.values(e).find(Boolean);if(r)return r}return t}function V(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function F(e){return`<i class="ki-outline ${e} fs-2"></i>`}function G(e){return e.replace(/\.(\w+)/g,"[$1]")}function M(e){k&&(k.disabled=e,k.dataset.ktIndicator=e?"on":"off")}});
