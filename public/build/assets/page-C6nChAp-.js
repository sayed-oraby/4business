import{a as x}from"./index-B9ygI19o.js";document.addEventListener("DOMContentLoaded",()=>{const n=window.PageModule||{},d=$("#pages-table");if(!d.length)return;const j=n.locale||document.documentElement.lang||"en",r=document.getElementById("pageForm"),I=document.getElementById("pageFormModal"),q=I?new bootstrap.Modal(I):null,l=document.getElementById("pageViewModal"),z=l?new bootstrap.Modal(l):null,L=document.querySelector('[data-page-action="bulk-delete"]'),E=document.getElementById("select-all-pages"),T=document.head.querySelector('meta[name="csrf-token"]')?.content,w=r?.querySelector("[data-page-slug]"),A=r?.querySelector("[data-page-title-en]");let k=!1;const h=l?{image:l.querySelector('[data-page-view="image"]'),title:l.querySelector('[data-page-view="title"]'),description:l.querySelector('[data-page-view="description"]'),descriptionBlock:l.querySelector('[data-page-view="description-block"]'),slug:l.querySelector('[data-page-view="slug"]'),status:l.querySelector('[data-page-view="status"]'),state:l.querySelector('[data-page-view="state"]'),translations:l.querySelector('[data-page-view="translations"]'),created_at:l.querySelector('[data-page-view="created_at"]'),updated_at:l.querySelector('[data-page-view="updated_at"]')}:{},b={status:"",state:"active"},o=new Set,u=d.DataTable({processing:!0,serverSide:!0,order:[],ajax:(e,t)=>{const a={draw:e.draw,start:e.start,length:e.length,"search[value]":e.search?.value,"order[0][column]":e.order?.[0]?.column,"order[0][dir]":e.order?.[0]?.dir,status:b.status,state:b.state};b.state==="archived"?a.trashed="only":b.state==="all"&&(a.trashed="with"),x.get(n.routes.data,{params:a}).then(s=>t(s.data)).catch(()=>t({data:[],recordsTotal:0,recordsFiltered:0,draw:e.draw}))},columnDefs:[{targets:0,orderable:!1,className:"text-center align-middle"},{targets:-1,orderable:!1,className:"text-end"}],columns:[{data:"id",render:e=>`
                    <div class="form-check form-check-sm form-check-custom">
                        <input class="form-check-input page-select" type="checkbox" value="${e}">
                    </div>
                `},{data:null,render:(e,t,a)=>{const s=_(a.title_translations,a.title),i=_(a.description_translations,a.description);return`
                        <div class="d-flex align-items-center">
                            <img src="${a.image_url||""}" class="page-thumb me-4" alt="${s??""}">
                            <div class="d-flex flex-column">
                                <span class="fw-bold text-gray-900">${s??"—"}</span>
                                <span class="text-muted fs-7">${i??"—"}</span>
                            </div>
                        </div>
                    `}},{data:"slug",render:e=>`<span class="fw-semibold text-gray-700">${e??"—"}</span>`},{data:null,render:(e,t,a)=>{if(a.is_deleted)return`<span class="badge badge-light-danger">${n.states?.archived??a.state_label}</span>`;const s=n.statusLabels?.[a.status]??a.status_label??a.status;return`<span class="badge ${a.status==="published"?"badge-light-success":a.status==="draft"?"badge-light-warning":"badge-light"}">${s}</span>`}},{data:"updated_at",render:e=>`<span class="text-muted fw-semibold">${D(e)}</span>`},{data:null,render:e=>{const t=[];return t.push(`
                        <button class="btn btn-sm btn-icon btn-light-info" data-page-action="view" title="${n.i18n.view}" data-id="${e.id}">
                            ${M("ki-eye")}
                        </button>
                    `),n.can?.update&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-primary" data-page-action="edit" title="${n.i18n.edit}" data-id="${e.id}">
                                ${M("ki-pencil")}
                            </button>
                        `),n.can?.delete&&t.push(`
                            <button class="btn btn-sm btn-icon btn-light-danger" data-page-action="delete" title="${n.i18n.delete}" data-id="${e.id}">
                                ${M("ki-trash")}
                            </button>
                        `),`<div class="d-flex justify-content-end gap-2">${t.join("")}</div>`}}],drawCallback:()=>{d.find(".page-select").each(function(){this.checked=o.has(this.value)}),S()}});document.getElementById("page-search")?.addEventListener("keyup",e=>{u.search(e.target.value).draw()}),document.querySelectorAll('[data-page-filter="status"]').forEach(e=>{e.addEventListener("change",t=>{b.status=t.target.value,u.ajax.reload()})}),document.querySelectorAll('[data-page-filter="state"]').forEach(e=>{e.addEventListener("change",t=>{b.state=t.target.value||"active",u.ajax.reload()})}),document.querySelectorAll('[data-page-action="open-form"]').forEach(e=>{e.addEventListener("click",()=>{F(),q?.show()})}),d.on("click",'[data-page-action="view"]',function(){const e=u.row($(this).closest("tr")).data();e&&(R(e),z?.show())}),d.on("click",'[data-page-action="edit"]',function(){const e=u.row($(this).closest("tr")).data();e&&(V(e),q?.show())}),d.on("click",'[data-page-action="delete"]',function(){const e=this.getAttribute("data-id");e&&O("single").then(t=>{t&&x.post(n.routes.destroy.replace("__ID__",e),{_method:"DELETE"},{headers:{"X-CSRF-TOKEN":T}}).then(()=>{v(n.messages.deleted),o.delete(e),u.ajax.reload(null,!1),S()}).catch(()=>v("Error",!0))})}),d.on("change",".page-select",function(){const e=String(this.value);e&&(this.checked?o.add(e):o.delete(e),S())}),E?.addEventListener("change",()=>{const e=E.checked;d.find(".page-select").each(function(){this.checked=e;const t=String(this.value);t&&(e?o.add(t):o.delete(t))}),S()}),L?.addEventListener("click",()=>{o.size!==0&&O("bulk",o.size).then(e=>{e&&x.post(n.routes.bulkDestroy,{ids:Array.from(o),_method:"DELETE"},{headers:{"X-CSRF-TOKEN":T}}).then(()=>{v(n.messages.bulkDeleted),o.clear(),u.ajax.reload(),S()}).catch(()=>v("Error",!0))})}),r?.addEventListener("submit",e=>{e.preventDefault(),K()}),w?.addEventListener("input",()=>{k=w.value.trim().length>0}),A?.addEventListener("input",()=>{!k&&w&&(w.value=X(A.value))});function F(){if(!r)return;r.reset(),k=!1;const e=r.querySelector('input[name="page_id"]'),t=r.querySelector('input[name="_method"]');e&&(e.value=""),t&&(t.value="POST"),N()}function V(e){if(!r)return;F();const t=r.querySelector('input[name="page_id"]'),a=r.querySelector('input[name="_method"]');t&&(t.value=e.id),a&&(a.value="PUT"),C('input[name="slug"]',e.slug??""),k=!!e.slug,C('select[name="status"]',e.status??""),Object.entries(e.title_translations??{}).forEach(([s,i])=>{C(`input[name="title[${s}]"]`,i)}),Object.entries(e.description_translations??{}).forEach(([s,i])=>{const c=r.querySelector(`textarea[name="description[${s}]"]`);c&&(c.value=i??"")})}function C(e,t){if(!r)return;const a=r.querySelector(e);a&&(a.value=t??"")}function K(){if(!r)return;const e=r.querySelector('input[name="page_id"]')?.value,t=!!e,a=new FormData(r),s=t?n.routes.update.replace("__ID__",e):n.routes.store;t||a.set("_method","POST"),N(),x.post(s,a,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":T}}).then(()=>{q?.hide(),u.ajax.reload(null,!1),v(t?n.messages.updated:n.messages.created)}).catch(i=>P(i))}function N(){r&&(r.querySelectorAll(".is-invalid").forEach(e=>e.classList.remove("is-invalid")),r.querySelectorAll(".invalid-feedback").forEach(e=>e.remove()),r.querySelectorAll("[data-error-for]").forEach(e=>{e.textContent="",e.style.display="none"}))}function P(e){if(!r)return;const t=new Set,a=r.querySelector("[data-page-errors]");e.response?.status===422&&e.response?.data?.errors?(Object.entries(e.response.data.errors).forEach(([s,i])=>{const c=Array.isArray(i)?i[0]:i;t.add(c);const y=H(s),g=r.querySelector(`[name="${y}"]`);let p=r.querySelector(`[data-error-for="${s}"]`);if(p||(p=r.querySelector(`[data-error-for="${y}"]`)),g&&g.classList.add("is-invalid"),p)p.textContent=c,p.style.display="block";else if(g){let m=g.parentNode.querySelector(".invalid-feedback");m||(m=document.createElement("div"),m.classList.add("invalid-feedback"),g.parentNode.appendChild(m)),m.textContent=c}}),a&&t.size>0&&(a.classList.remove("d-none"),a.innerHTML='<ul class="mb-0">'+Array.from(t).map(s=>`<li>${s}</li>`).join("")+"</ul>")):v("Error",!0)}function H(e){return e.replace(/\.(\w+)/g,"[$1]")}function R(e){if(!l)return;h.image&&(h.image.src=e.image_url||"",h.image.alt=e.title??"");const t=_(e.title_translations,e.title),a=_(e.description_translations,e.description);if(f("title",t),f("description",a),f("descriptionBlock",a),f("slug",e.slug),f("status",n.statusLabels?.[e.status]??e.status_label??e.status),f("state",e.state_label??(e.is_deleted?n.states?.archived:n.states?.active)),f("created_at",D(e.created_at)),f("updated_at",D(e.updated_at)),h.translations){const s=h.translations;s.innerHTML="";let i=!1;const c=n.locales||{};Object.entries(c).forEach(([y,g])=>{const p=e.title_translations?.[y]??"",m=e.description_translations?.[y]??"";if(!p&&!m)return;i=!0;const B=document.createElement("div");B.classList.add("mb-3"),B.innerHTML=`
                    <div class="fw-bold text-gray-900">${g.native??y.toUpperCase()}</div>
                    <div class="text-muted fs-7">
                        <div><span class="fw-semibold">${n.view?.fields?.title??"Title"}:</span> ${p||"—"}</div>
                        <div><span class="fw-semibold">${n.view?.fields?.description??"Description"}:</span> ${m||"—"}</div>
                    </div>
                `,s.appendChild(B)}),i||(s.textContent=n.view?.translationsEmpty||"—")}}function f(e,t){const a=h[e];a&&(a.textContent=t??"—")}function v(e,t=!1){window.toastr?t?toastr.error(e):toastr.success(e):alert(e)}function O(e,t=1){if(!window.Swal)return Promise.resolve(confirm(n.confirm?.deleteMessage??"Are you sure?"));const a=n.confirm||{},s=e==="bulk"?a.bulkTitle:a.deleteTitle;let i=e==="bulk"?a.bulkMessage:a.deleteMessage;return e==="bulk"&&(i=i?.replace(":count",t)),Swal.fire({title:s,text:i,icon:"warning",showCancelButton:!0,confirmButtonText:a.confirm||"OK",cancelButtonText:a.cancel||"Cancel",customClass:{confirmButton:"btn btn-danger",cancelButton:"btn btn-light"},buttonsStyling:!1}).then(c=>c.isConfirmed)}function S(){const e=d.find(".page-select"),t=d.find(".page-select:checked");E&&(E.checked=t.length>0&&t.length===e.length,E.indeterminate=t.length>0&&t.length<e.length),L&&(L.disabled=o.size===0)}function _(e={},t=null){if(e&&typeof e=="object"){if(e[j])return e[j];const a=document.documentElement.dataset.fallbackLocale||"en";if(e[a])return e[a];const s=Object.values(e).find(Boolean);if(s)return s}return t}function D(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()}function M(e){return`<i class="ki-outline ${e} fs-2"></i>`}function X(e){return e?.toString().normalize("NFKD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").replace(/-{2,}/g,"-")||""}});
